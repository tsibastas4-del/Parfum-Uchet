<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ú® PerfumeFlow Pro v12.4 (CRM/Analytics Upgrade)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4F46E5; /* Indigo */
            --primary-hover: #4338ca;
            --secondary: #10B981; /* Emerald */
            --danger: #EF4444; /* Red */
            --warning: #F59E0B; /* Amber */
            --dark: #1F2937;
            --light: #F3F4F6;
            --white: #FFFFFF;
            --border: #E5E7EB;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            margin: 0;
            padding-top: 70px; 
            padding-bottom: 40px;
            -webkit-font-smoothing: antialiased;
        }

        /* --- NAVIGATION --- */
        .navbar {
            background-color: var(--white);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 1000;
        }

        .navbar-brand {
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .navbar-links {
            display: flex;
            gap: 5px;
            overflow-x: auto; 
            white-space: nowrap;
            padding-bottom: 0;
            -ms-overflow-style: none;  
            scrollbar-width: none;  
        }
        .navbar-links::-webkit-scrollbar { display: none; }

        .nav-btn {
            background: transparent;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            color: #6B7280;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-btn:hover { background-color: #F3F4F6; color: var(--primary); }
        .nav-btn.active { background-color: #EEF2FF; color: var(--primary); }

        /* --- LAYOUT & CARDS --- */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 15px;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }
        .content-section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--white);
            border-radius: 12px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        h1, h2, h3 { margin-top: 0; color: #111827; }
        h2 { font-size: 1.5rem; margin-bottom: 20px; border-bottom: 2px solid var(--light); padding-bottom: 10px; }

        /* --- FORMS --- */
        .grid-3-col { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .grid-2-col { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }

        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; color: #4B5563; }
        
        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            box-sizing: border-box;
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: #F9FAFB;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            background-color: var(--white);
        }

        /* --- BUTTONS --- */
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.1s, opacity 0.2s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:active { transform: scale(0.98); }
        
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover { background-color: var(--primary-hover); }
        
        .btn-success { background-color: var(--secondary); color: white; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-warning { background-color: var(--warning); color: white; }
        
        .btn-sm { padding: 6px 12px; font-size: 0.85rem; width: auto; display: inline-flex; }

        /* --- TABLES --- */
        .table-responsive { overflow-x: auto; border-radius: 8px; border: 1px solid var(--border); }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        
        th { background-color: #F9FAFB; text-align: left; padding: 12px 15px; font-size: 0.85rem; color: #6B7280; text-transform: uppercase; letter-spacing: 0.05em; }
        td { padding: 12px 15px; border-top: 1px solid var(--border); font-size: 0.95rem; }
        tr:hover td { background-color: #F3F4F6; }
        
        .text-right { text-align: right; }
        .text-bold { font-weight: 700; }
        .text-success { color: var(--secondary); }
        .text-danger { color: var(--danger); }

        /* --- TOAST NOTIFICATIONS --- */
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast {
            background: var(--white);
            color: var(--dark);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            border-left: 5px solid var(--primary);
            animation: slideIn 0.3s ease-out;
            min-width: 250px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .toast.success { border-left-color: var(--secondary); }
        .toast.error { border-left-color: var(--danger); }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* --- DASHBOARD WIDGETS --- */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: linear-gradient(135deg, var(--primary), var(--primary-hover)); color: white; padding: 20px; border-radius: 12px; box-shadow: var(--shadow); }
        .stat-card.green { background: linear-gradient(135deg, var(--secondary), #059669); }
        .stat-card h3 { color: rgba(255,255,255,0.8); font-size: 0.9rem; margin-bottom: 5px; font-weight: 500; }
        .stat-card .value { font-size: 1.8rem; font-weight: 800; }

        /* --- MODAL --- */
        .modal { display: none; position: fixed; z-index: 3000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(4px); animation: fadeIn 0.2s; }
        .modal-content { background-color: var(--white); margin: 5% auto; padding: 0; border-radius: 12px; width: 95%; max-width: 500px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); overflow: hidden; }
        .modal-header { padding: 15px 20px; border-bottom: 1px solid var(--border); background: #F9FAFB; display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; }
        .receipt-total { font-size: 1.5rem; font-weight: 800; text-align: right; color: var(--primary); margin-top: 15px; border-top: 2px dashed var(--border); padding-top: 15px; }

        /* Print Logic */
        @media print {
            body * { visibility: hidden; }
            .modal.active, .modal.active * { visibility: visible; }
            .modal { position: absolute; left: 0; top: 0; background: white; }
            .no-print { display: none; }
        }

        /* Mobile specific adjustments */
        @media (max-width: 768px) {
            .navbar-links { position: fixed; bottom: 0; left: 0; right: 0; top: auto; background: white; border-top: 1px solid var(--border); padding: 10px; justify-content: space-around; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
            .nav-btn { flex-direction: column; font-size: 0.7rem; gap: 4px; padding: 5px; width: 20%; text-align: center; }
            .nav-btn i { font-size: 1.2rem; }
            .container { padding-bottom: 80px; } 
            .navbar-brand { margin: 0 auto; }
            .navbar { justify-content: center; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>

    <nav class="navbar">
        <div class="navbar-brand">
            <i class="fa-solid fa-spray-can-sparkles"></i> PerfumeFlow Pro
        </div>
        <div class="navbar-links">
            <button class="nav-btn active" onclick="showSection('dashboard', this)"><i class="fa-solid fa-chart-pie"></i> –ì–æ–ª–æ–≤–Ω–∞</button>
            <button class="nav-btn" onclick="showSection('input-form', this)"><i class="fa-solid fa-cart-plus"></i> –ü—Ä–æ–¥–∞–∂</button>
            <button class="nav-btn" onclick="showSection('multi-calculator', this)"><i class="fa-solid fa-list-check"></i> –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
            <button class="nav-btn" onclick="showSection('transactions', this)"><i class="fa-solid fa-clock-rotate-left"></i> –Ü—Å—Ç–æ—Ä—ñ—è</button>
            <button class="nav-btn" onclick="showSection('admin-panel', this)"><i class="fa-solid fa-gears"></i> –ê–¥–º—ñ–Ω–∫–∞</button>
            <button class="nav-btn" onclick="showSection('crm-management', this); renderClientList();"><i class="fa-solid fa-users"></i> CRM</button>
            <button class="nav-btn" onclick="showSection('analytics-dashboard', this); renderAnalyticsCharts();"><i class="fa-solid fa-chart-line"></i> –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</button>
        </div>
    </nav>

    <div id="toast-container"></div>

    <div class="container">

        <section id="dashboard" class="content-section active">
            <h2>üëã –í—ñ—Ç–∞—î–º–æ! –û–≥–ª—è–¥ –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–í–∏—Ä—É—á–∫–∞ —Å—å–æ–≥–æ–¥–Ω—ñ</h3>
                    <div class="value" id="dash-revenue">0 ‚Ç¥</div>
                </div>
                <div class="stat-card green">
                    <h3>–ü—Ä–∏–±—É—Ç–æ–∫ —Å—å–æ–≥–æ–¥–Ω—ñ</h3>
                    <div class="value" id="dash-profit">0 ‚Ç¥</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #F59E0B, #D97706);">
                    <h3>–ü—Ä–æ–¥–∞–∂—ñ–≤</h3>
                    <div class="value" id="dash-count">0</div>
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fa-solid fa-bolt"></i> –®–≤–∏–¥–∫—ñ –¥—ñ—ó</h3>
                <div class="grid-2-col">
                    <button class="btn-primary" onclick="showSection('input-form', document.querySelectorAll('.nav-btn')[1])"><i class="fa-solid fa-plus"></i> –ù–æ–≤–∏–π –ø—Ä–æ–¥–∞–∂</button>
                    <button class="btn-success" onclick="showSection('report', null)"><i class="fa-solid fa-file-invoice-dollar"></i> –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–≤—ñ—Ç</button>
                </div>
            </div>
        </section>

        <section id="input-form" class="content-section">
            <div class="card">
                <h2><i class="fa-solid fa-bottle-droplet"></i> –®–≤–∏–¥–∫–∏–π –ø—Ä–æ–¥–∞–∂</h2>
                <div class="grid-3-col" style="margin-bottom: 15px;">
                    <div>
                        <label>–ù–∞—Ü—ñ–Ω–∫–∞</label>
                        <select id="saleMarkupTierSingle"></select>
                    </div>
                    <div>
                        <label>–î–∂–µ—Ä–µ–ª–æ</label>
                        <select id="saleSourceSingle"></select>
                    </div>
                    <div>
                        <label>–ö–ª—ñ—î–Ω—Ç (–æ–ø—Ü—ñ–π–Ω–æ)</label>
                        <input type="text" id="clientNameSingle" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è..." list="clientList">
                    </div>
                </div>
                
                <label>–ù–∞–∑–≤–∞ –ü–∞—Ä—Ñ—É–º—É</label>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <input type="text" id="perfumeName" list="perfumeList" placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É...">
                </div>

                <label>–û–±'—î–º (–º–ª)</label>
                <select id="flaconVolume" style="margin-bottom: 20px;"></select>
                
                <button class="btn-primary" onclick="addSale()"><i class="fa-solid fa-check"></i> –ó–∞—Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ –ü—Ä–æ–¥–∞–∂</button>
            </div>
        </section>

        <section id="multi-calculator" class="content-section">
            <div class="card">
                <h2><i class="fa-solid fa-basket-shopping"></i> –ö–æ—à–∏–∫ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
                <div class="grid-3-col" style="margin-bottom: 15px;">
                     <div><label>–ù–∞—Ü—ñ–Ω–∫–∞</label><select id="saleMarkupTierOrder"></select></div>
                     <div><label>–î–∂–µ—Ä–µ–ª–æ</label><select id="saleSourceOrder"></select></div>
                     <div><label>–ö–ª—ñ—î–Ω—Ç</label><input type="text" id="clientNameOrder" placeholder="–Ü–º'—è –∫–ª—ñ—î–Ω—Ç–∞" list="clientList"></div>
                </div>

                <div style="background: #F9FAFB; padding: 15px; border-radius: 8px; border: 1px dashed var(--border); margin-bottom: 15px;">
                    <div class="grid-2-col">
                        <div><label>–ü–∞—Ä—Ñ—É–º</label><input type="text" id="orderPerfumeName" list="perfumeList"></div>
                        <div><label>–û–±'—î–º</label><select id="orderFlaconVolume"></select></div>
                    </div>
                    <button class="btn-warning" style="margin-top: 10px;" onclick="addItemToOrder()"><i class="fa-solid fa-plus-circle"></i> –î–æ–¥–∞—Ç–∏ –ø–æ–∑–∏—Ü—ñ—é</button>
                </div>

                <div class="table-responsive">
                    <table id="order-list-table">
                        <thead><tr><th>–ü–∞—Ä—Ñ—É–º</th><th class="text-right">–û–±'—î–º</th><th class="text-right">–¶—ñ–Ω–∞</th><th class="text-right">–î—ñ—è</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                
                <div id="orderTotalSection" style="margin: 20px 0; font-size: 1.2rem; font-weight: bold; text-align: right; color: var(--primary);"></div>
                
                <h3 style="margin-top: 20px;"><i class="fa-solid fa-copy"></i> –¢–µ–∫—Å—Ç –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è)</h3>
                <textarea id="orderSummaryOutput" rows="4" readonly placeholder="–¢–µ–∫—Å—Ç –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑'—è–≤–∏—Ç—å—Å—è —Ç—É—Ç..."></textarea>
                <button class="btn-warning" style="margin-top: 10px;" onclick="copyOrderSummary()"><i class="fa-solid fa-copy"></i> –ö–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç</button>
                <div class="grid-2-col" style="margin-top: 20px;">
                    <button class="btn-success" onclick="processOrder()"><i class="fa-solid fa-cash-register"></i> –û—Ñ–æ—Ä–º–∏—Ç–∏</button>
                    <button class="btn-danger" onclick="clearOrder()"><i class="fa-solid fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç–∏</button>
                </div>
            </div>
        </section>

        <section id="report" class="content-section">
            <div class="card">
                <h2><i class="fa-solid fa-chart-line"></i> –ó–≤—ñ—Ç–Ω—ñ—Å—Ç—å</h2>
                <div class="grid-2-col" style="margin-bottom: 15px;">
                    <div><label>–ó –¥–∞—Ç–∏</label><input type="date" id="startDate"></div>
                    <div><div><label>–ü–æ –¥–∞—Ç—É</label><input type="date" id="endDate"></div></div>
                </div>
                <button class="btn-primary" onclick="generateReport()"><i class="fa-solid fa-filter"></i> –°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ –ó–≤—ñ—Ç</button>
                <div id="reportOutput" style="margin-top: 20px;"></div>
            </div>
        </section>

        <section id="transactions" class="content-section">
            <div class="card">
                <h2><i class="fa-solid fa-history"></i> –Ü—Å—Ç–æ—Ä—ñ—è –ü—Ä–æ–¥–∞–∂—ñ–≤</h2>
                <div class="grid-3-col" style="margin-bottom: 15px;">
                    <div><input type="text" id="transactionSearch" onkeyup="renderTransactionHistory()" placeholder="üîç –ü–æ—à—É–∫..."></div>
                    <div><select id="historyFilterSource" onchange="renderTransactionHistory()"></select></div>
                    <div><input type="date" id="historyStartDate" onchange="renderTransactionHistory()"></div>
                </div>

                <div class="table-responsive">
                    <table id="transaction-history-table">
                        <thead><tr><th>–î–∞—Ç–∞</th><th>–ö–ª—ñ—î–Ω—Ç</th><th>–Ü–Ω—Ñ–æ</th><th>–ü–∞—Ä—Ñ—É–º</th><th class="text-right">–°—É–º–∞</th><th class="text-right">–ü—Ä–∏–±—É—Ç–æ–∫</th><th class="text-right">–î—ñ—è</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
                <p id="transactionSummary" style="margin-top: 15px; font-weight: 600; text-align: right;"></p>
            </div>
        </section>

        <section id="client-crm" class="content-section">
            <div class="card">
                <h2><i class="fa-solid fa-users"></i> CRM –ö–ª—ñ—î–Ω—Ç—ñ–≤</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="clientSearchInput" list="clientList" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –∫–ª—ñ—î–Ω—Ç–∞...">
                    <button class="btn-primary" style="width: auto;" onclick="showClientHistory()"><i class="fa-solid fa-search"></i></button>
                </div>
                <div id="clientCrmSummary"></div>
                <div class="table-responsive">
                    <table id="client-history-table">
                        <thead><tr><th>–î–∞—Ç–∞</th><th>–ü–∞—Ä—Ñ—É–º</th><th class="text-right">–°—É–º–∞</th><th class="text-right">–ü—Ä–∏–±—É—Ç–æ–∫</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="admin-panel" class="content-section">
            <div class="grid-2-col" style="margin-bottom: 20px;">
                <button class="btn-primary" onclick="showSection('report', null)">üìä –§—ñ–Ω–∞–Ω—Å–æ–≤—ñ –∑–≤—ñ—Ç–∏</button>
                <button class="btn-primary" onclick="showSection('client-history', null)">üë• –Ü—Å—Ç–æ—Ä—ñ—è –ö–ª—ñ—î–Ω—Ç–∞</button>
                <button class="btn-primary" onclick="showSection('expenses', null)">üí∏ –î–æ–¥–∞—Ç–∏ –í–∏—Ç—Ä–∞—Ç—É</button>
                <button class="btn-primary" onclick="showSection('calculator', null)">üßÆ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ü—ñ–Ω–∏</button>
            </div>
            
            <div class="card">
                <h3><i class="fa-solid fa-file-invoice"></i> –ü—Ä–∞–π—Å-–ª–∏—Å—Ç –¥–ª—è –∫–ª—ñ—î–Ω—Ç—ñ–≤ (–¶—ñ–Ω–∞ –∑–∞ –º–ª)</h3>
                <label>–í–∏–±–µ—Ä—ñ—Ç—å –Ω–∞—Ü—ñ–Ω–∫—É –¥–ª—è –ø—Ä–∞–π—Å—É:</label>
                <select id="priceListMarkup"></select>
                <button class="btn-warning" style="margin-top: 10px;" onclick="generatePriceList()"><i class="fa-solid fa-list-ul"></i> –°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏ —Ç–∞ —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏</button>
                <textarea id="priceListOutput" rows="10" readonly placeholder="–¢—É—Ç –±—É–¥–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π –ø—Ä–∞–π—Å-–ª–∏—Å—Ç –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è..." style="margin-top: 15px;"></textarea>
            </div>
            
            <div class="card">
                <h3><i class="fa-solid fa-database"></i> –î–æ–≤—ñ–¥–Ω–∏–∫ –ü–∞—Ä—Ñ—É–º—ñ–≤</h3>
                <div style="margin-bottom: 15px; background: #F9FAFB; padding: 15px; border-radius: 8px; border: 1px solid var(--border);">
                    <div class="grid-2-col" style="margin-bottom: 10px;">
                        <input type="text" id="adminPerfumeName" placeholder="–ù–∞–∑–≤–∞ –ø–∞—Ä—Ñ—É–º—É">
                        <input type="number" id="adminBasePrice" placeholder="–°/–° (–≥—Ä–Ω/–º–ª) –ë–ï–ó –ó–ù–ò–ñ–ö–ò">
                    </div>
                    <div class="grid-2-col" style="margin-bottom: 10px;">
                        <input type="number" id="adminDiscountVolume" placeholder="–û–±'—î–º –¥–ª—è –∑–Ω–∏–∂–∫–∏ (–º–ª)" value="5">
                        <input type="number" id="adminDiscountPrice" placeholder="–°/–° –∑—ñ –∑–Ω–∏–∂–∫–æ—é (–≥—Ä–Ω/–º–ª)">
                    </div>
                    <button class="btn-success" onclick="addOrUpdatePerfume()"><i class="fa-solid fa-save"></i> –ó–±–µ—Ä–µ–≥—Ç–∏/–û–Ω–æ–≤–∏—Ç–∏</button>
                </div>
                <input type="text" id="perfumeSearchInput" onkeyup="renderPerfumeList()" placeholder="üîç –ü–æ—à—É–∫ —É –¥–æ–≤—ñ–¥–Ω–∏–∫—É..." style="margin-bottom: 10px;">
                
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                    <table id="perfume-list-table">
                        <thead><tr><th>–ù–∞–∑–≤–∞</th><th class="text-right">–°/–°</th><th class="text-right">–î—ñ—è</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3><i class="fa-solid fa-flask"></i> –§–ª–∞–∫–æ–Ω–∏ & –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>
                <div class="grid-2-col">
                    <div>
                        <label>–î–æ–¥–∞—Ç–∏ –§–ª–∞–∫–æ–Ω (–û–±'—î–º / –¶—ñ–Ω–∞)</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="number" id="adminFlaconVolume" placeholder="–º–ª">
                            <input type="number" id="adminFlaconCost" placeholder="–≥—Ä–Ω">
                            <button class="btn-success" style="width: auto;" onclick="addOrUpdateFlacon()"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                    <div>
                        <label>–î–æ–¥–∞—Ç–∏ –ù–∞—Ü—ñ–Ω–∫—É (–ù–∞–∑–≤–∞ / –ö–æ–µ—Ñ)</label>
                        <div style="display: flex; gap: 5px;">
                            <input type="text" id="adminMarkupName" placeholder="–ù–∞–ø—Ä: VIP">
                            <input type="number" id="adminMarkupValue" placeholder="0.10">
                            <button class="btn-success" style="width: auto;" onclick="addOrUpdateMarkupPreset()"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="border: 1px solid var(--danger);">
                <h3><i class="fa-solid fa-database"></i> –ö–µ—Ä—É–≤–∞–Ω–Ω—è –î–∞–Ω–∏–º–∏</h3>
                <p>–í–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —î –Ω–µ–∑–≤–æ—Ä–æ—Ç–Ω—ñ–º!</p>
                <div class="grid-2-col">
                    <button class="btn-danger" onclick="clearAllData()"><i class="fa-solid fa-exclamation-triangle"></i> –û—á–∏—Å—Ç–∏—Ç–∏ –í–°–Ü –î–ê–ù–Ü</button>
                    <button class="btn-danger" onclick="resetDefaultData()"><i class="fa-solid fa-rotate-left"></i> –°–∫–∏–Ω—É—Ç–∏ –¥–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å</button>
                </div>
            </div>
        </section>

        <section id="calculator" class="content-section" style="display:none;">
            <div class="card">
                <h2><i class="fa-solid fa-calculator"></i> –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¶—ñ–Ω</h2>
                <div class="grid-2-col" style="margin-bottom: 15px;">
                    <div><label>–ü–∞—Ä—Ñ—É–º</label><input type="text" id="calcPerfumeName" list="perfumeList" onchange="calculatePrice()"></div>
                    <div><label>–û–±'—î–º (–º–ª)</label><select id="calcFlaconVolume" onchange="calculatePrice()"></select></div>
                </div>
                <div><label>–ù–∞—Ü—ñ–Ω–∫–∞</label><select id="calcMarkupTier" onchange="calculatePrice()"></select></div>
                <div id="calculatorOutput" style="margin-top: 20px;"></div>
            </div>
        </section>

        <section id="expenses" class="content-section" style="display:none;">
            <div class="card">
                <h2><i class="fa-solid fa-money-bill-transfer"></i> –û–±–ª—ñ–∫ –í–∏—Ç—Ä–∞—Ç</h2>
                <div class="grid-2-col">
                    <input type="text" id="expenseDescription" placeholder="–û–ø–∏—Å –≤–∏—Ç—Ä–∞—Ç–∏">
                    <input type="number" id="expenseAmount" placeholder="–°—É–º–∞ (–≥—Ä–Ω)">
                </div>
                <button class="btn-danger" onclick="addExpense()"><i class="fa-solid fa-plus"></i> –î–æ–¥–∞—Ç–∏ –≤–∏—Ç—Ä–∞—Ç—É</button>
                
                <h3 style="margin-top: 30px;">–Ü—Å—Ç–æ—Ä—ñ—è –í–∏—Ç—Ä–∞—Ç</h3>
                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                    <table id="expense-list-table">
                        <thead><tr><th>–î–∞—Ç–∞</th><th>–û–ø–∏—Å</th><th class="text-right">–°—É–º–∞</th><th class="text-right">–î—ñ—è</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="client-history" class="content-section" style="display:none;">
             <div class="card">
                <h2><i class="fa-solid fa-users"></i> –Ü—Å—Ç–æ—Ä—ñ—è –ö–ª—ñ—î–Ω—Ç–∞</h2>
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <input type="text" id="clientSearchInput" list="clientList" placeholder="–í–≤–µ–¥—ñ—Ç—å —ñ–º'—è –∫–ª—ñ—î–Ω—Ç–∞...">
                    <button class="btn-primary" style="width: auto;" onclick="showClientHistory()"><i class="fa-solid fa-search"></i></button>
                </div>
                <div id="clientCrmSummary"></div>
                <div class="table-responsive">
                    <table id="client-history-table">
                        <thead><tr><th>–î–∞—Ç–∞</th><th>–ü–∞—Ä—Ñ—É–º</th><th class="text-right">–°—É–º–∞</th><th class="text-right">–ü—Ä–∏–±—É—Ç–æ–∫</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>
        
        <section id="crm-management" class="content-section" style="display:none;">
            <h2>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç–∞–º–∏</h2>
            <p class="text-secondary">–¢—É—Ç –≤–∏ –º–æ–∂–µ—Ç–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω—ñ –¥–∞–Ω—ñ –∫–ª—ñ—î–Ω—Ç—ñ–≤ (—Ç–µ–ª–µ—Ñ–æ–Ω, email, –¥–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è) —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.</p>
            
            <div class="card">
                <h3>–î–æ–¥–∞—Ç–∏ / –û–Ω–æ–≤–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <input type="text" id="newClientName" placeholder="–Ü–º'—è –∫–ª—ñ—î–Ω—Ç–∞ (–£–Ω—ñ–∫–∞–ª—å–Ω–µ)" class="input-light">
                    <input type="text" id="newClientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" class="input-light">
                    <input type="email" id="newClientEmail" placeholder="Email" class="input-light">
                    <input type="date" id="newClientDOB" title="–î–∞—Ç–∞ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è" class="input-light">
                    <button class="btn-primary" onclick="addUpdateClient(document.getElementById('newClientName').value.trim(), document.getElementById('newClientPhone').value.trim(), document.getElementById('newClientEmail').value.trim(), document.getElementById('newClientDOB').value.trim())">‚ûï –ó–±–µ—Ä–µ–≥—Ç–∏ / –û–Ω–æ–≤–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞</button>
                </div>
            </div>

            <div class="card">
                <h3>–°–ø–∏—Å–æ–∫ –∫–ª—ñ—î–Ω—Ç—ñ–≤ —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="table-responsive">
                    <table id="clientListTable" class="data-table">
                        <thead>
                            <tr>
                                <th>–Ü–º'—è</th>
                                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                <th>Email</th>
                                <th>–ü–æ–∫—É–ø–æ–∫</th>
                                <th class="text-right">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∏—Ä—É—á–∫–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                            </tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="analytics-dashboard" class="content-section" style="display:none;">
            <h2>üìä –ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∞ –ø–∞–Ω–µ–ª—å</h2>

            <div class="stats-grid">
                <div class="stat-card" style="background: linear-gradient(135deg, var(--primary), var(--primary-hover));">
                    <h3>–ó–∞–≥–∞–ª—å–Ω–∏–π –ø—Ä–∏–±—É—Ç–æ–∫ (–í—Å—è —ñ—Å—Ç–æ—Ä—ñ—è)</h3>
                    <div class="value" id="totalProfitCard">0 ‚Ç¥</div>
                </div>
                <div class="stat-card green" style="background: linear-gradient(135deg, var(--secondary), #059669);">
                    <h3>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</h3>
                    <div class="value" id="totalTransactionsCard">0</div>
                </div>
            </div>

            <div class="card">
                <h3>–î–∏–Ω–∞–º—ñ–∫–∞ –≤–∏—Ä—É—á–∫–∏ (–∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤)</h3>
                <div style="height: 300px;"><canvas id="revenueChart"></canvas></div>
            </div>
            
            <div class="card">
                <h3>–¢–æ–ø-5 –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏—Ö –ø–∞—Ä—Ñ—É–º—ñ–≤ (–∑–∞ –æ–±'—î–º–æ–º, –º–ª)</h3>
                <div style="height: 300px;"><canvas id="topPerfumeChart"></canvas></div>
            </div>
        </section>
        </div> 

    <div id="receiptModal" class="modal">
        <div class="modal-content">
            <div id="receiptContent"></div>
        </div>
    </div>
    
    <datalist id="perfumeList"></datalist>
    <datalist id="clientList"></datalist>
    <script>
        // --- CONFIG ---
        const CONFIG_KEYS = {
            PRICES: 'perfumePrices',
            VOLUMES: 'flaconVolumes',
            FLACONS: 'flaconCosts',
            MARKUPS: 'markupPresets',
            SOURCES: 'salesSources',
            TRANSACTIONS: 'transactions',
            EXPENSES: 'expenses',
        };

        let PERFUME_PRICES = {};
        let FLACON_VOLUMES = [5, 10, 15, 20, 30, 50, 60];
        let FLACON_COSTS = { 5: 25, 10: 27, 15: 30, 20: 40, 30: 50, 50: 70, 60: 70 };
        let MARKUP_PRESETS = { "–†–æ–∑–¥—Ä—ñ–±": 0.12, "–û–ø—Ç-1": 0.08, "VIP": 0.10 };
        let SALES_SOURCES = ["Instagram", "OLX", "–ú–∞–≥–∞–∑–∏–Ω", "–†–µ—Ñ–µ—Ä–∞–ª"];
        let CURRENT_ORDER_LIST = []; 

        // --- INITIAL DATA ---
        // –°/–°: basePrice (–≥—Ä–Ω/–º–ª), discountVolume (–º–ª), discountPrice (–≥—Ä–Ω/–º–ª)
        const INITIAL_PRICES = {
           "27 87 Perfumes Genetic Bliss": { "basePrice": 160, "discountVolume": 5, "discountPrice": 155 },
                "Acqua di Parma Colonia Club": { "basePrice": 45, "discountVolume": 5, "discountPrice": 40 },
                "Acqua di Parma Colonia Futura": { "basePrice": 35, "discountVolume": 5, "discountPrice": 33 },
                "Acqua di Parma Colonia Intensa": { "basePrice": 36, "discountVolume": 5, "discountPrice": 35 },
                "Acqua di Parma Colonia Pura": { "basePrice": 37, "discountVolume": 5, "discountPrice": 35 },
                "Afnan 9 PM Black": { "basePrice": 20, "discountVolume": 10, "discountPrice": 18 },
                "Afnan 9 PM Rebel": { "basePrice": 20, "discountVolume": 5, "discountPrice": 18 },
                "Afnan 9am Pour Femme": { "basePrice": 20, "discountVolume": 5, "discountPrice": 18 },
                "Afnan 9pm Pour Femme": { "basePrice": 18, "discountVolume": 5, "discountPrice": 16 },
                "Afnan Cherry Bouquet": { "basePrice": 35, "discountVolume": 5, "discountPrice": 30 },
                "Afnan La Fleur Bouquet": { "basePrice": 30, "discountVolume": 5, "discountPrice": 28 },
                "Afnan Mirsaal With Love": { "basePrice": 23, "discountVolume": 5, "discountPrice": 22 },
                "Afnan Mirsaal of Trust": { "basePrice": 25, "discountVolume": 5, "discountPrice": 24 },
                "Afnan Rare Carbon": { "basePrice": 22, "discountVolume": 5, "discountPrice": 21 },
                "Afnan Supremacy Collector's Edition": { "basePrice": 30, "discountVolume": 5, "discountPrice": 27 },
                "Afnan Supremacy Femme Pink": { "basePrice": 24, "discountVolume": 5, "discountPrice": 22 },
                "Afnan Supremacy Gala": { "basePrice": 28, "discountVolume": 5, "discountPrice": 25 },
                "Afnan Supremacy in Oud": { "basePrice": 25, "discountVolume": 5, "discountPrice": 23 },
                "Afnan Supremacy Incense": { "basePrice": 16, "discountVolume": 5, "discountPrice": 15 },
                "Afnan Supremacy Not Only Intense": { "basePrice": 27, "discountVolume": 5, "discountPrice": 26 },
                "Afnan Supremacy Silver": { "basePrice": 25, "discountVolume": 10, "discountPrice": 22 },
                "Afnan Supremacy in Heaven": { "basePrice": 23, "discountVolume": 10, "discountPrice": 22 },
                "Afnan Tobacco Rush": { "basePrice": 30, "discountVolume": 5, "discountPrice": 28 },
                "Al Haramain Amber Oud Aqua Dubai": { "basePrice": 32, "discountVolume": 5, "discountPrice": 28 },
                "Al Haramain Amber Oud Dubai Night": { "basePrice": 32, "discountVolume": 5, "discountPrice": 29 },
                "Al Haramain Amber Oud Gold Edition Extreme": { "basePrice": 32, "discountVolume": 5, "discountPrice": 30 },
                "Al Haramain Amber Oud Ruby Edition": { "basePrice": 30, "discountVolume": 5, "discountPrice": 25 },
                "Al Haramain Amber Oud Tobacco Edition": { "basePrice": 38, "discountVolume": 5, "discountPrice": 37 },
                "Al Haramain Detour Noir": { "basePrice": 14, "discountVolume": 10, "discountPrice": 13 },
                "Al Haramain Detour Noir Exclusif": { "basePrice": 20, "discountVolume": 5, "discountPrice": 17 },
                "Al Haramain L‚ÄôAventure": { "basePrice": 18, "discountVolume": 10, "discountPrice": 14 },
                "Al Haramain L‚ÄôAventure Intense": { "basePrice": 28, "discountVolume": 10, "discountPrice": 26 },
                "Al Haramain L‚ÄôAventure Fraiche": { "basePrice": 29, "discountVolume": 5, "discountPrice": 26 },
                "Alfred Dunhill Icon": { "basePrice": 34, "discountVolume": 5, "discountPrice": 32 },
                "Amouage Interlude Man": { "basePrice": 75, "discountVolume": 5, "discountPrice": 74 },
                "Antonio Banderas Blue Seduction Wave": { "basePrice": 12, "discountVolume": 10, "discountPrice": 11 },
                "Ard al Zaafaran Midnight Oud": { "basePrice": 21, "discountVolume": 5, "discountPrice": 20 },
                "Armaf Blue Homme": { "basePrice": 15, "discountVolume": 10, "discountPrice": 14 },
                "Armaf Club De Nuit Blue Iconic": { "basePrice": 23, "discountVolume": 5, "discountPrice": 20 },
                "Armaf Club De Nuit Intense Woman": { "basePrice": 17, "discountVolume": 5, "discountPrice": 15 },
                "Armaf Club De Nuit Sillage": { "basePrice": 20, "discountVolume": 10, "discountPrice": 19 },
                "Armaf Club De Nuit Urban Elixir": { "basePrice": 22, "discountVolume": 5, "discountPrice": 20 },
                "Armaf Club De Nuit Woman": { "basePrice": 16, "discountVolume": 5, "discountPrice": 15 },
                "Armaf Club de Nuit Intense Man EDT": { "basePrice": 18, "discountVolume": 5, "discountPrice": 16 },
                "Armaf Club de Nuit Intense Man Parfum": { "basePrice": 25, "discountVolume": 5, "discountPrice": 23 },
                "Armaf Club de Nuit Milestone": { "basePrice": 18, "discountVolume": 5, "discountPrice": 16 },
                "Arte Olfatto Black Hashish": { "basePrice": 55, "discountVolume": 5, "discountPrice": 52 },
                "Attar Collection Musk Kashmir": { "basePrice": 44, "discountVolume": 5, "discountPrice": 42 },
                "Azzaro Chrome": { "basePrice": 22, "discountVolume": 10, "discountPrice": 20 },
                "Azzaro Chrome Legend": { "basePrice": 14, "discountVolume": 10, "discountPrice": 13 },
                "Azzaro Chrome Parfum": { "basePrice": 25, "discountVolume": 10, "discountPrice": 23 },
                "Azzaro Forever Wanted Elixir": { "basePrice": 58, "discountVolume": 5, "discountPrice": 55 },
                "Azzaro The Most Wanted": { "basePrice": 43, "discountVolume": 5, "discountPrice": 40 },
                "Azzaro The Most Wanted Intense EDT": { "basePrice": 33, "discountVolume": 5, "discountPrice": 32 },
                "Azzaro The Most Wanted Parfum": { "basePrice": 45, "discountVolume": 10, "discountPrice": 44 },
                "Azzaro Wanted EDP": { "basePrice": 32, "discountVolume": 10, "discountPrice": 30 },
                "Azzaro Wanted by Night": { "basePrice": 40, "discountVolume": 5, "discountPrice": 37 },
                "Bentley Intense for Men": { "basePrice": 15, "discountVolume": 10, "discountPrice": 13 },
                "Bois 1920 Cannabis Fruttata": { "basePrice": 58, "discountVolume": 5, "discountPrice": 55 },
                "Bois 1920 Parana": { "basePrice": 60, "discountVolume": 5, "discountPrice": 55 },
                "Burberry Her Elixir": { "basePrice": 50, "discountVolume": 5, "discountPrice": 49 },
                "Burberry Hero Parfum": { "basePrice": 41, "discountVolume": 5, "discountPrice": 39 },
                "Burberry Hero Parfum Intense": { "basePrice": 47, "discountVolume": 5, "discountPrice": 45 },
                "Burberry London For Men": { "basePrice": 19, "discountVolume": 5, "discountPrice": 17 },
                "Bvlgari Aqva Pour Homme": { "basePrice": 47, "discountVolume": 5, "discountPrice": 45 },
                "Bvlgari Le Gemme Orom": { "basePrice": 155, "discountVolume": 5, "discountPrice": 150 },
                "Bvlgari Man In Black": { "basePrice": 42, "discountVolume": 10, "discountPrice": 40 },
                "Bvlgari Man In Black Parfum": { "basePrice": 54, "discountVolume": 5, "discountPrice": 49 },
                "Bvlgari Man Terrae Essence": { "basePrice": 44, "discountVolume": 5, "discountPrice": 42 },
                "Bvlgari Man Wood Neroli": { "basePrice": 40, "discountVolume": 5, "discountPrice": 35 },
                "Bvlgari Omnia Coral": { "basePrice": 52, "discountVolume": 5, "discountPrice": 50 },
                "Bvlgari Omnia Crystalline": { "basePrice": 52, "discountVolume": 5, "discountPrice": 48 },
                "Bvlgari Pour Homme EDP": { "basePrice": 45, "discountVolume": 5, "discountPrice": 43 },
                "By Kilian Angels Share": { "basePrice": 135, "discountVolume": 5, "discountPrice": 130 },
                "By Kilian Old Fashioned": { "basePrice": 130, "discountVolume": 5, "discountPrice": 125 },
                "Cacharel Noa": { "basePrice": 24, "discountVolume": 5, "discountPrice": 20 },
                "Carolina Herrera 212 Men": { "basePrice": 30, "discountVolume": 5, "discountPrice": 29 },
                "Carolina Herrera 212 NYC": { "basePrice": 38, "discountVolume": 5, "discountPrice": 36 },
                "Carolina Herrera 212 VIP Black Elixir": { "basePrice": 50, "discountVolume": 5, "discountPrice": 48 },
                "Carolina Herrera Bad Boy Cobalt Elixir": { "basePrice": 49, "discountVolume": 10, "discountPrice": 45 },
                "Carolina Herrera Bad Boy Elixir": { "basePrice": 55, "discountVolume": 10, "discountPrice": 50 },
                "Carolina Herrera Bad Boy Extreme": { "basePrice": 49, "discountVolume": 5, "discountPrice": 45 },
                "Carolina Herrera Bad Boy Le Parfum": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Carolina Herrera CH Men Pasion": { "basePrice": 42, "discountVolume": 5, "discountPrice": 40 },
                "Carolina Herrera CH Men Prive": { "basePrice": 55, "discountVolume": 10, "discountPrice": 50 },
                "Carolina Herrera Chic For Men": { "basePrice": 30, "discountVolume": 5, "discountPrice": 28 },
                "Carolina Herrera Good Girl": { "basePrice": 40, "discountVolume": 5, "discountPrice": 37 },
                // --- –ß–∞—Å—Ç–∏–Ω–∞ 2 ---
                "Carolina Herrera Good Girl Supreme": { "basePrice": 55, "discountVolume": 5, "discountPrice": 50 },
                "Cartier Declaration": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Cartier Declaration Haute Fraicheur": { "basePrice": 33, "discountVolume": 10, "discountPrice": 30 },
                "Chanel Allure Homme Edition Blanche": { "basePrice": 64, "discountVolume": 5, "discountPrice": 60 },
                "Chanel Allure Homme Sport": { "basePrice": 55, "discountVolume": 5, "discountPrice": 50 },
                "Chanel Allure Homme Sport Cologne": { "basePrice": 55, "discountVolume": 5, "discountPrice": 50 },
                "Chanel Bleu de Chanel": { "basePrice": 50, "discountVolume": 5, "discountPrice": 47 },
                "Chanel Egoiste": { "basePrice": 60, "discountVolume": 5, "discountPrice": 55 },
                "Chanel Egoiste Platinum": { "basePrice": 60, "discountVolume": 5, "discountPrice": 55 },
                "Chloe Eau de Parfum": { "basePrice": 35, "discountVolume": 5, "discountPrice": 32 },
                "Chopard Black Incense Malaki": { "basePrice": 30, "discountVolume": 5, "discountPrice": 28 },
                "Chopard Cedar Malaki": { "basePrice": 39, "discountVolume": 5, "discountPrice": 36 },
                "Dior Homme 2020": { "basePrice": 42, "discountVolume": 5, "discountPrice": 40 },
                "Dior Homme Cologne 2022": { "basePrice": 44, "discountVolume": 10, "discountPrice": 37 },
                "Dior Homme Intense 2011": { "basePrice": 55, "discountVolume": 5, "discountPrice": 53 },
                "Dior Homme Parfum 2025": { "basePrice": 90, "discountVolume": 5, "discountPrice": 85 },
                "Christian Dior Eau Sauvage Parfum": { "basePrice": 65, "discountVolume": 5, "discountPrice": 62 },
                "Christian Dior Fahrenheit": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Christian Dior Fahrenheit Le Parfum": { "basePrice": 68, "discountVolume": 5, "discountPrice": 63 },
                "Christian Dior Homme Sport 2021": { "basePrice": 38, "discountVolume": 5, "discountPrice": 37 },
                "Christian Dior Hypnotic Poison": { "basePrice": 52, "discountVolume": 5, "discountPrice": 48 },
                "Christian Dior J'Adore EDT": { "basePrice": 47, "discountVolume": 5, "discountPrice": 46 },
                "Christian Dior J'Adore Infinissime": { "basePrice": 46, "discountVolume": 5, "discountPrice": 45 },
                "Christian Dior Miss Dior Essence": { "basePrice": 75, "discountVolume": 5, "discountPrice": 73 },
                "Christian Dior Miss Dior Rose N‚ÄôRoses": { "basePrice": 44, "discountVolume": 5, "discountPrice": 42 },
                "Christian Dior Sauvage 2015": { "basePrice": 39, "discountVolume": 5, "discountPrice": 35 },
                "Christian Dior Sauvage EDP 2018": { "basePrice": 47, "discountVolume": 5, "discountPrice": 45 },
                "Christian Dior Sauvage Elixir": { "basePrice": 99, "discountVolume": 5, "discountPrice": 95 },
                "Clinique Happy for Men": { "basePrice": 24, "discountVolume": 10, "discountPrice": 22 },
                "Coach Green": { "basePrice": 20, "discountVolume": 10, "discountPrice": 18 },
                "Creed Millesime Imperial": { "basePrice": 67, "discountVolume": 5, "discountPrice": 65 },
                "D&G L‚ÄôImperatrice": { "basePrice": 24, "discountVolume": 5, "discountPrice": 23 },
                "D&G Light Blue Italian Love": { "basePrice": 35, "discountVolume": 5, "discountPrice": 33 },
                "D&G Light Blue Pour Femme": { "basePrice": 27, "discountVolume": 5, "discountPrice": 25 },
                "D&G Light Blue Summer Vibes": { "basePrice": 35, "discountVolume": 10, "discountPrice": 32 },
                "D&G Light Blue Summer Vibes PH": { "basePrice": 29, "discountVolume": 10, "discountPrice": 28 },
                "D&G The One EDP": { "basePrice": 42, "discountVolume": 5, "discountPrice": 40 },
                "D&G The One for Men EDT": { "basePrice": 29, "discountVolume": 5, "discountPrice": 27 },
                "D&G The One for Men EDP": { "basePrice": 37, "discountVolume": 5, "discountPrice": 35 },
                "Escentric Molecules Escentric 03": { "basePrice": 38, "discountVolume": 5, "discountPrice": 36 },
                "Escentric Molecules Escentric 04": { "basePrice": 43, "discountVolume": 5, "discountPrice": 40 },
                "Escentric Molecules Molecule 05": { "basePrice": 35, "discountVolume": 5, "discountPrice": 30 },
                "Essential Parfums Bois Imperial Extrait": { "basePrice": 220, "discountVolume": 5, "discountPrice": 219 },
                "Ex Nihilo Outcast Blue Extrait": { "basePrice": 163, "discountVolume": 5, "discountPrice": 160 },
                "Fragrance World French Avenue Liquid Brun": { "basePrice": 27, "discountVolume": 5, "discountPrice": 25 },
                "Franck Boclet Patchouli": { "basePrice": 38, "discountVolume": 5, "discountPrice": 36 },
                "Franck Boclet Tobacco": { "basePrice": 38, "discountVolume": 5, "discountPrice": 36 },
                "Armani Acqua Di Gio Parfum": { "basePrice": 34, "discountVolume": 5, "discountPrice": 30 },
                "Armani Acqua di Gio EDT": { "basePrice": 37, "discountVolume": 5, "discountPrice": 35 },
                "Armani Acqua di Gio Absolu": { "basePrice": 40, "discountVolume": 10, "discountPrice": 39 },
                "Armani Acqua di Gio EDP": { "basePrice": 30, "discountVolume": 5, "discountPrice": 28 },
                "Armani Acqua di Gio Pour Homme": { "basePrice": 29, "discountVolume": 5, "discountPrice": 25 },
                "Armani Acqua di Gio Pour Homme 2024": { "basePrice": 32, "discountVolume": 5, "discountPrice": 30 },
                "Armani Acqua di Gio Profondo": { "basePrice": 32, "discountVolume": 10, "discountPrice": 28 },
                "Armani Acqua di Gio Profondo Parfum": { "basePrice": 45, "discountVolume": 5, "discountPrice": 43 },
                "Armani Acqua di Gioia": { "basePrice": 45, "discountVolume": 5, "discountPrice": 42 },
                "Armani Acqua di Gioia Intense": { "basePrice": 48, "discountVolume": 5, "discountPrice": 45 },
                "Armani Code Parfum": { "basePrice": 39, "discountVolume": 5, "discountPrice": 37 },
                "Armani Eau de Nuit": { "basePrice": 43, "discountVolume": 5, "discountPrice": 42 },
                "Armani Because It‚Äôs You": { "basePrice": 39, "discountVolume": 5, "discountPrice": 37 },
                "Armani Stronger With You": { "basePrice": 36, "discountVolume": 5, "discountPrice": 34 },
                "Armani Stronger With You Absolutely": { "basePrice": 43, "discountVolume": 5, "discountPrice": 40 },
                "Armani Stronger With You Intensely": { "basePrice": 40, "discountVolume": 5, "discountPrice": 36 },
                "Armani Stronger With You Leather": { "basePrice": 50, "discountVolume": 5, "discountPrice": 49 },
                "Armani Stronger With You Oud": { "basePrice": 48, "discountVolume": 5, "discountPrice": 47 },
                "Armani Stronger With You Parfum": { "basePrice": 57, "discountVolume": 5, "discountPrice": 55 },
                "Armani Stronger With You Tobacco": { "basePrice": 42, "discountVolume": 5, "discountPrice": 39 },
                "Armani My Way": { "basePrice": 39, "discountVolume": 5, "discountPrice": 37 },
                "Armani My Way Parfum": { "basePrice": 50, "discountVolume": 5, "discountPrice": 48 },
                "Armani Si": { "basePrice": 39, "discountVolume": 5, "discountPrice": 37 },
                "Armani Si Passione Intense": { "basePrice": 45, "discountVolume": 5, "discountPrice": 44 },
                "Givenchy Ange ou Demon": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Givenchy Ange ou Demon Le Secret": { "basePrice": 42, "discountVolume": 5, "discountPrice": 40 },
                "Givenchy Gentleman Boisee EDP": { "basePrice": 30, "discountVolume": 5, "discountPrice": 28 },
                "Givenchy Gentleman EDP": { "basePrice": 35, "discountVolume": 0, "discountPrice": 35 }, // –ë–µ–∑ –º—ñ–Ω—ñ–º–∞–ª–∫–∏, discountVolume: 0
                "Givenchy Gentleman Intense": { "basePrice": 30, "discountVolume": 5, "discountPrice": 29 },
                "Givenchy Gentleman Original": { "basePrice": 34, "discountVolume": 5, "discountPrice": 30 },
                "Givenchy Gentleman Reserve Privee": { "basePrice": 35, "discountVolume": 5, "discountPrice": 33 },
                "Givenchy Gentleman Society Ambree": { "basePrice": 49, "discountVolume": 5, "discountPrice": 45 },
                "Givenchy Gentleman Society Extreme": { "basePrice": 43, "discountVolume": 5, "discountPrice": 41 },
                "Givenchy L‚ÄôInterdit Intense": { "basePrice": 47, "discountVolume": 5, "discountPrice": 45 },
                "Givenchy L‚ÄôInterdit EDT": { "basePrice": 41, "discountVolume": 5, "discountPrice": 40 },
                "Givenchy Pour Homme": { "basePrice": 25, "discountVolume": 5, "discountPrice": 22 },
                "Givenchy Pour Homme Blue Label": { "basePrice": 25, "discountVolume": 5, "discountPrice": 23 },
                "Givenchy Very Irresistible": { "basePrice": 44, "discountVolume": 5, "discountPrice": 42 },
                "Gucci Bloom": { "basePrice": 37, "discountVolume": 5, "discountPrice": 35 },
                // --- –ß–∞—Å—Ç–∏–Ω–∞ 3 (–ù–æ–≤–∏–π –ø–∞–∫–µ—Ç) ---
                "Gucci Bloom Profumo di Fiori": { "basePrice": 41, "discountVolume": 5, "discountPrice": 40 },
                "Gucci Guilty Intense Pour Femme": { "basePrice": 54, "discountVolume": 5, "discountPrice": 50 },
                "Gucci Guilty Elixir pour Homme": { "basePrice": 89, "discountVolume": 5, "discountPrice": 85 },
                "Gucci Guilty Essence pour Homme": { "basePrice": 39, "discountVolume": 10, "discountPrice": 36 },
                "Gucci Guilty Pour Femme Absolute": { "basePrice": 50, "discountVolume": 5, "discountPrice": 46 },
                "Gucci Guilty Pour Femme EDT": { "basePrice": 42, "discountVolume": 5, "discountPrice": 40 },
                "Gucci Guilty Pour Homme Absolute": { "basePrice": 29, "discountVolume": 5, "discountPrice": 27 },
                "Gucci Intense Oud": { "basePrice": 45, "discountVolume": 5, "discountPrice": 43 },
                "Gucci Rush": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Guerlain L‚ÄôHomme Ideal": { "basePrice": 33, "discountVolume": 5, "discountPrice": 30 },
                "Guerlain La Petite Robe Noire": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Guerlain La Petite Robe Noire Absolue": { "basePrice": 42, "discountVolume": 5, "discountPrice": 38 },
                "Hermes H24 EDP": { "basePrice": 33, "discountVolume": 5, "discountPrice": 30 },
                "Hermes H24 EDT": { "basePrice": 28, "discountVolume": 5, "discountPrice": 26 },
                "Hermes H24 Herbes Vives": { "basePrice": 43, "discountVolume": 10, "discountPrice": 40 },
                "Hermes Jour d‚ÄôHermes": { "basePrice": 48, "discountVolume": 5, "discountPrice": 44 },
                "Hermes Jour d‚ÄôHermes Absolu": { "basePrice": 60, "discountVolume": 5, "discountPrice": 57 },
                "Hermes Terre d‚ÄôHermes EDT": { "basePrice": 34, "discountVolume": 5, "discountPrice": 32 },
                "Hermes Terre d‚ÄôHermes Parfum": { "basePrice": 42, "discountVolume": 5, "discountPrice": 40 },
                "Hermes Terre d‚ÄôHermes Eau Givree": { "basePrice": 39, "discountVolume": 5, "discountPrice": 38 },
                "Hermes Terre d‚ÄôHermes Intense Vetiver": { "basePrice": 35, "discountVolume": 5, "discountPrice": 34 },
                "Hermes Terre d‚ÄôHermes Flacon H 2019": { "basePrice": 65, "discountVolume": 5, "discountPrice": 60 },
                "Hermes Terre d‚ÄôHermes Intense": { "basePrice": 45, "discountVolume": 5, "discountPrice": 40 },
                "Hermes Un Jardin sur le Nil": { "basePrice": 39, "discountVolume": 5, "discountPrice": 37 },
                "Hermes Voyage d‚ÄôHermes Parfum": { "basePrice": 50, "discountVolume": 5, "discountPrice": 48 },
                "Histoires de Parfums 1725 Casanova": { "basePrice": 30, "discountVolume": 5, "discountPrice": 29 },
                "Histoires de Parfums 1740 Marquis de Sade": { "basePrice": 44, "discountVolume": 5, "discountPrice": 42 },
                "Histoires de Parfums 1899 Hemingway": { "basePrice": 40, "discountVolume": 5, "discountPrice": 37 },
                "Histoires de Parfums Ambre 114": { "basePrice": 40, "discountVolume": 5, "discountPrice": 37 },
                "Hugo Boss Bottled Absolu": { "basePrice": 45, "discountVolume": 5, "discountPrice": 40 },
                "Hugo Boss Bottled Elixir": { "basePrice": 49, "discountVolume": 5, "discountPrice": 46 },
                "Hugo Boss Bottled Triumph Elixir": { "basePrice": 39, "discountVolume": 5, "discountPrice": 37 },
                "Hugo Boss The Scent Elixir": { "basePrice": 43, "discountVolume": 5, "discountPrice": 39 },
                "Hugo Boss The Scent Le Parfum": { "basePrice": 38, "discountVolume": 5, "discountPrice": 37 },
                "Hugo Boss The Scent for Him": { "basePrice": 23, "discountVolume": 5, "discountPrice": 20 },
                "Issey Miyake L‚ÄôEau Bleue d‚ÄôIssey": { "basePrice": 32, "discountVolume": 5, "discountPrice": 28 },
                "Issey Miyake Wood & Wood": { "basePrice": 28, "discountVolume": 5, "discountPrice": 27 },
                "Issey Miyake Le Sel d‚ÄôIssey": { "basePrice": 33, "discountVolume": 5, "discountPrice": 32 },
                "Jean Paul Gaultier Divine Elixir": { "basePrice": 54, "discountVolume": 5, "discountPrice": 50 },
                "Jean Paul Gaultier Le Beau": { "basePrice": 43, "discountVolume": 5, "discountPrice": 41 },
                "Jean Paul Gaultier Le Beau Le Parfum": { "basePrice": 55, "discountVolume": 5, "discountPrice": 53 },
                "Jean Paul Gaultier Le Beau Paradise Garden": { "basePrice": 46, "discountVolume": 5, "discountPrice": 44 },
                "Jean Paul Gaultier Le Male": { "basePrice": 32, "discountVolume": 5, "discountPrice": 28 },
                "Jean Paul Gaultier Le Male Elixir": { "basePrice": 45, "discountVolume": 5, "discountPrice": 39 },
                "Jean Paul Gaultier Le Male Elixir Absolu": { "basePrice": 45, "discountVolume": 5, "discountPrice": 40 },
                "Jean Paul Gaultier Le Male Le Parfum": { "basePrice": 39, "discountVolume": 5, "discountPrice": 36 },
                "Jean Paul Gaultier Scandal": { "basePrice": 49, "discountVolume": 5, "discountPrice": 47 },
                "Jean Paul Gaultier Scandal Absolu": { "basePrice": 58, "discountVolume": 5, "discountPrice": 53 },
                "Jean Paul Gaultier Scandal Pour Homme": { "basePrice": 32, "discountVolume": 5, "discountPrice": 30 },
                "Jean Paul Gaultier Scandal Pour Homme Absolu": { "basePrice": 49, "discountVolume": 5, "discountPrice": 45 },
                "Jean Paul Gaultier Scandal Pour Homme Le Parfum": { "basePrice": 44, "discountVolume": 5, "discountPrice": 40 },
                "Jean Paul Gaultier Ultra Male": { "basePrice": 37, "discountVolume": 5, "discountPrice": 34 },
                "John Varvatos Artisan": { "basePrice": 19, "discountVolume": 5, "discountPrice": 17 },
                "John Varvatos Artisan Pure": { "basePrice": 25, "discountVolume": 10, "discountPrice": 24 },
                "John Varvatos For Men": { "basePrice": 20, "discountVolume": 5, "discountPrice": 19 },
                "John Varvatos XX Artisan Teal": { "basePrice": 24, "discountVolume": 10, "discountPrice": 23 },
                "Juliette Has A Gun Ex Vetiver": { "basePrice": 48, "discountVolume": 5, "discountPrice": 45 },
                "Kenzo Homme 2022": { "basePrice": 35, "discountVolume": 10, "discountPrice": 29 },
                "Kenzo Santal Marin": { "basePrice": 36, "discountVolume": 5, "discountPrice": 35 },
                "Kenzo L‚ÄôEau Kenzo pour Homme": { "basePrice": 24, "discountVolume": 5, "discountPrice": 21 },
                "Lacoste Pour Femme": { "basePrice": 30, "discountVolume": 5, "discountPrice": 26 },
                "Lalique Encre Indigo": { "basePrice": 24, "discountVolume": 5, "discountPrice": 21 },
                "Lalique Encre Noire": { "basePrice": 14, "discountVolume": 10, "discountPrice": 12 },
                "Lalique Encre Noire Sport": { "basePrice": 14, "discountVolume": 10, "discountPrice": 13 },
                "Lalique Encre Noire √† L‚ÄôExtreme": { "basePrice": 16, "discountVolume": 10, "discountPrice": 14 },
                "Lalique Ombre Noire": { "basePrice": 37, "discountVolume": 5, "discountPrice": 34 },
                "Lancome La Vie Est Belle": { "basePrice": 38, "discountVolume": 5, "discountPrice": 35 },
                "Lancome La Vie Est Belle L‚ÄôElixir": { "basePrice": 49, "discountVolume": 5, "discountPrice": 46 },
                "Lancome Miracle": { "basePrice": 42, "discountVolume": 5, "discountPrice": 40 },
                "Lancome Tresor": { "basePrice": 39, "discountVolume": 5, "discountPrice": 37 },
                "Lattafa Asad": { "basePrice": 15, "discountVolume": 10, "discountPrice": 14 },
                "Lattafa Asad Bourbon": { "basePrice": 20, "discountVolume": 5, "discountPrice": 18 },
                "Lattafa Asad Zanzibar": { "basePrice": 14, "discountVolume": 10, "discountPrice": 13 },
                "Lattafa Badee Al Oud Oud for Glory": { "basePrice": 16, "discountVolume": 10, "discountPrice": 15 },
                "Lattafa Fakhar Extrait": { "basePrice": 18, "discountVolume": 5, "discountPrice": 17 },
                "Lattafa Fakhar Platin": { "basePrice": 25, "discountVolume": 5, "discountPrice": 22 },
                "Lattafa Fakhar for Men": { "basePrice": 18, "discountVolume": 10, "discountPrice": 17 },
                "Lattafa Khamrah": { "basePrice": 22, "discountVolume": 5, "discountPrice": 20 },
                "Lattafa Khamrah Dukhan": { "basePrice": 25, "discountVolume": 5, "discountPrice": 24 },
                "Lattafa Khamrah Qahwa": { "basePrice": 20, "discountVolume": 10, "discountPrice": 17 },
                "Lattafa Musamam White Intense": { "basePrice": 28, "discountVolume": 5, "discountPrice": 25 },
                "Lattafa Pride Masa": { "basePrice": 22, "discountVolume": 5, "discountPrice": 20 },
                "Lattafa Pride Vintage Radio": { "basePrice": 20, "discountVolume": 10, "discountPrice": 16 },
                "Lattafa Yara": { "basePrice": 15, "discountVolume": 5, "discountPrice": 13 },
                "Lattafa Yara Candy": { "basePrice": 20, "discountVolume": 5, "discountPrice": 17 },
                "Lattafa Yara Tous": { "basePrice": 16, "discountVolume": 5, "discountPrice": 15 },
                "Loewe Solo Loewe": { "basePrice": 45, "discountVolume": 10, "discountPrice": 40 },
                "Maison Margiela Replica Autumn Vibes": { "basePrice": 55, "discountVolume": 5, "discountPrice": 52 },
                "Maison Margiela Replica Beach Walk": { "basePrice": 45, "discountVolume": 5, "discountPrice": 43 },
                "Maison Margiela Replica By the Fireplace": { "basePrice": 55, "discountVolume": 5, "discountPrice": 50 },
                "Maison Margiela Replica Flying": { "basePrice": 50, "discountVolume": 5, "discountPrice": 45 },
                "Maison Margiela Replica Jazz Club": { "basePrice": 51, "discountVolume": 5, "discountPrice": 49 },
                "Maison Margiela Replica On A Date": { "basePrice": 55, "discountVolume": 5, "discountPrice": 50 },
                "Maison Margiela Replica Under the Stars": { "basePrice": 54, "discountVolume": 5, "discountPrice": 50 },
                "Mancera Amore Caffe": { "basePrice": 39, "discountVolume": 5, "discountPrice": 36 },
                // --- –ß–∞—Å—Ç–∏–Ω–∞ 4 (–ù–æ–≤–∏–π –ø–∞–∫–µ—Ç: Mancera - Prada) V8.11 ---
                "Mancera Cedrat Boise EDP": { "basePrice": 34, "discountVolume": 5, "discountPrice": 32 },
                "Mancera Cedrat Boise Intense Parfum": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Mancera Cosmic Pepper EDP": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Mancera Eternal Wood EDP": { "basePrice": 39, "discountVolume": 5, "discountPrice": 36 },
                "Mancera Red Tobacco EDP": { "basePrice": 38, "discountVolume": 5, "discountPrice": 36 },
                "Mancera Red Tobacco Intense EDP": { "basePrice": 45, "discountVolume": 5, "discountPrice": 40 },
                "Mancera Roses Vanille EDP": { "basePrice": 32, "discountVolume": 5, "discountPrice": 29 },
                "Mancera Tonka Cola EDP": { "basePrice": 39, "discountVolume": 5, "discountPrice": 35 },
                "Mercedes-Benz Man Private EDP": { "basePrice": 30, "discountVolume": 5, "discountPrice": 29 },
                "Missoni Parfum Pour Homme EDP": { "basePrice": 20, "discountVolume": 5, "discountPrice": 18 },
                "Missoni Wave EDT": { "basePrice": 25, "discountVolume": 5, "discountPrice": 24 },
                "Montale Arabians Tonka EDP": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Montale Intense Cafe EDP": { "basePrice": 35, "discountVolume": 5, "discountPrice": 34 },
                "Montale Red Vetiver EDP": { "basePrice": 37, "discountVolume": 5, "discountPrice": 36 },
                "Montblanc Explorer EDP": { "basePrice": 23, "discountVolume": 5, "discountPrice": 20 },
                "Montblanc Explorer Extreme Parfum": { "basePrice": 40, "discountVolume": 5, "discountPrice": 36 },
                "Montblanc Explorer Platinum EDP": { "basePrice": 22, "discountVolume": 5, "discountPrice": 19 },
                "Moschino Toy 2 EDT": { "basePrice": 27, "discountVolume": 5, "discountPrice": 24 },
                "Moschino Toy 2 Bubble Gum EDT": { "basePrice": 26, "discountVolume": 5, "discountPrice": 25 },
                "Moschino Toy 2 Pearl EDP": { "basePrice": 35, "discountVolume": 5, "discountPrice": 30 },
                "Moschino Toy Boy EDP": { "basePrice": 28, "discountVolume": 5, "discountPrice": 26 },
                "Nasomatto Black Afgano Parfum": { "basePrice": 210, "discountVolume": 5, "discountPrice": 205 },
                "Nautica Voyage EDT": { "basePrice": 13, "discountVolume": 10, "discountPrice": 12 }, 
                "Nina Ricci Nina EDT": { "basePrice": 33, "discountVolume": 5, "discountPrice": 30 },
                "Nishane Hacivat X": { "basePrice": 83, "discountVolume": 5, "discountPrice": 80 },
                "Novellista Unique Wood EDP": { "basePrice": 40, "discountVolume": 5, "discountPrice": 38 },
                "Novellista Vanilla Club EDP": { "basePrice": 43, "discountVolume": 5, "discountPrice": 41 },
                "Olfactive Studio Autoportrait EDP": { "basePrice": 39, "discountVolume": 10, "discountPrice": 37 }, 
                "Orlov Paris Good Vibes EDP": { "basePrice": 62, "discountVolume": 5, "discountPrice": 60 },
                "Orto Parisi Bergamask Parfum": { "basePrice": 149, "discountVolume": 5, "discountPrice": 140 },
                "Paco Rabanne 1 Million EDT": { "basePrice": 30, "discountVolume": 5, "discountPrice": 27 },
                "Paco Rabanne 1 Million Elixir Parfum": { "basePrice": 45, "discountVolume": 5, "discountPrice": 44 },
                "Paco Rabanne 1 Million Parfum": { "basePrice": 38, "discountVolume": 5, "discountPrice": 35 },
                "Paco Rabanne Invictus Parfum": { "basePrice": 48, "discountVolume": 10, "discountPrice": 45 }, 
                "Paco Rabanne Invictus Victory EDP": { "basePrice": 34, "discountVolume": 5, "discountPrice": 32 },
                "Paco Rabanne Invictus Victory Absolu Parfum": { "basePrice": 50, "discountVolume": 5, "discountPrice": 47 },
                "Paco Rabanne Lady Million EDP": { "basePrice": 45, "discountVolume": 5, "discountPrice": 43 },
                "Paco Rabanne Lady Million Empire EDP": { "basePrice": 40, "discountVolume": 5, "discountPrice": 39 },
                "Paco Rabanne Million Gold EDP (102/200)": { "basePrice": 43, "discountVolume": 5, "discountPrice": 39 },
                "Paco Rabanne Million Gold EDP (67/200)": { "basePrice": 45, "discountVolume": 5, "discountPrice": 39 },
                "Paco Rabanne Million Gold Elixir Parfum": { "basePrice": 55, "discountVolume": 10, "discountPrice": 50 }, 
                "Paco Rabanne Olympea EDP": { "basePrice": 45, "discountVolume": 5, "discountPrice": 40 },
                "Paco Rabanne Phantom EDT": { "basePrice": 33, "discountVolume": 5, "discountPrice": 29 },
                "Perry Ellis 360¬∞ Red for Men EDT": { "basePrice": 17, "discountVolume": 5, "discountPrice": 16 },
                "Philipp Plein No Limit$ EDP": { "basePrice": 24, "discountVolume": 5, "discountPrice": 22 },
                "Philipp Plein No Limits Gold EDP": { "basePrice": 25, "discountVolume": 5, "discountPrice": 24 },
                "Prada L‚ÄôHomme EDT": { "basePrice": 43, "discountVolume": 5, "discountPrice": 40 },
                "Prada Luna Rossa EDT": { "basePrice": 37, "discountVolume": 5, "discountPrice": 35 },
                "Prada Luna Rossa Black EDP": { "basePrice": 46, "discountVolume": 5, "discountPrice": 44 },
                "Prada Luna Rossa Carbon EDT": { "basePrice": 42, "discountVolume": 5, "discountPrice": 40 },
                "Prada Luna Rossa Ocean EDT": { "basePrice": 43, "discountVolume": 5, "discountPrice": 40 },
                "Prada Luna Rossa Ocean Le Parfum": { "basePrice": 50, "discountVolume": 10, "discountPrice": 48 }, 
                "Prada Luna Rossa Sport EDT": { "basePrice": 37, "discountVolume": 5, "discountPrice": 35 },
// ===================================================================
// ================== –û–ù–û–í–õ–ï–ù–ù–Ø –ü–†–ê–ô–°–£ –í–Ü–î –ö–û–†–ò–°–¢–£–í–ê–ß–ê ================
// ===================================================================
"Ralph Lauren Ralp‚Äôs Club Elixir": {basePrice: 50, discountVolume: 5, discountPrice: 48},
"Rasasi Entebaa pour Homme": {basePrice: 20, discountVolume: 5, discountPrice: 17},
"Rasasi Fattan Pour Homme": {basePrice: 20, discountVolume: 5, discountPrice: 19},
"Rasasi La Yuqawam Pour Homme": {basePrice: 45, discountVolume: 5, discountPrice: 43},
"Rasasi Qasamat Bareeq": {basePrice: 30, discountVolume: 5, discountPrice: 29},
"Rasasi Rumz Al Rasasi 9325 Pour Lui": {basePrice: 30, discountVolume: 10, discountPrice: 25},
"Rasasi Rumz Al Rasasi 9453 Pour Lui": {basePrice: 36, discountVolume: 5, discountPrice: 35},
"Rasasi Tobacco Blaze": {basePrice: 44, discountVolume: 10, discountPrice: 40},
"Reyane Tradition Insurrection II Wild": {basePrice: 25, discountVolume: 0, discountPrice: 25}, // –ë–µ–∑ –∑–Ω–∏–∂–∫–∏
"Rochas Man Intense": {basePrice: 17, discountVolume: 5, discountPrice: 16},
"Rochas Moustache Eau de Parfum": {basePrice: 19, discountVolume: 5, discountPrice: 17},
"Salvatore Ferragamo Uomo Signature": {basePrice: 25, discountVolume: 5, discountPrice: 24},
"Serge Lutens Ambre Sultan": {basePrice: 50, discountVolume: 5, discountPrice: 45},
"Serge Lutens Chergui": {basePrice: 59, discountVolume: 5, discountPrice: 53},
"Shiseido Zen 2007": {basePrice: 35, discountVolume: 5, discountPrice: 33},
"Swiss Arabian Intense Pride": {basePrice: 25, discountVolume: 10, discountPrice: 23},
"Thierry Mugler AMen": {basePrice: 42, discountVolume: 5, discountPrice: 40},
"Thierry Mugler AMen Fantasm": {basePrice: 40, discountVolume: 5, discountPrice: 35},
"Thierry Mugler Alien Goddess": {basePrice: 49, discountVolume: 5, discountPrice: 45},
"Thierry Mugler Angel EDT 2019": {basePrice: 44, discountVolume: 5, discountPrice: 40},
"Thierry Mugler Angel Stellar": {basePrice: 54, discountVolume: 5, discountPrice: 50},
"Tiziana Terenzi Kirke": {basePrice: 48, discountVolume: 5, discountPrice: 46},
"Tiziana Terenzi Kirke Overdose": {basePrice: 95, discountVolume: 5, discountPrice: 92},
"Tom Ford Eau d‚ÄôOmbre Leather": {basePrice: 74, discountVolume: 5, discountPrice: 68},
"Tom Ford Ombre Leather (2018)": {basePrice: 74, discountVolume: 5, discountPrice: 70},
"Tom Ford Oud Minerale 2023": {basePrice: 60, discountVolume: 5, discountPrice: 56},
"Trussardi Donna 2011": {basePrice: 23, discountVolume: 5, discountPrice: 21},
"Trussardi Donna EDT": {basePrice: 23, discountVolume: 5, discountPrice: 20},
"Trussardi My Land": {basePrice: 25, discountVolume: 5, discountPrice: 22},
"Valentino Uomo Born In Roma Intense": {basePrice: 60, discountVolume: 10, discountPrice: 55},
"Valentino Uomo Born in Roma": {basePrice: 48, discountVolume: 5, discountPrice: 46},
"Valentino Donna": {basePrice: 49, discountVolume: 5, discountPrice: 45},
"Valentino Uomo": {basePrice: 43, discountVolume: 5, discountPrice: 42},
"Valentino Uomo Acqua": {basePrice: 35, discountVolume: 5, discountPrice: 34},
"Valentino Uomo Intense": {basePrice: 59, discountVolume: 5, discountPrice: 55},
"Versace Bright Crystal": {basePrice: 25, discountVolume: 5, discountPrice: 23},
"Versace Bright Crystal Absolu": {basePrice: 29, discountVolume: 5, discountPrice: 27},
"Versace Bright Crystal Parfum": {basePrice: 42, discountVolume: 5, discountPrice: 39},
"Versace Crystal Noir": {basePrice: 33, discountVolume: 5, discountPrice: 30},
"Versace Crystal Noir Parfum": {basePrice: 52, discountVolume: 5, discountPrice: 48},
"Versace Eros": {basePrice: 23, discountVolume: 5, discountPrice: 20},
"Versace Eros EDP": {basePrice: 28, discountVolume: 5, discountPrice: 26},
"Versace Eros Energy": {basePrice: 40, discountVolume: 5, discountPrice: 38},
"Versace Eros Flame": {basePrice: 29, discountVolume: 5, discountPrice: 25},
"Versace Eros Najim": {basePrice: 50, discountVolume: 10, discountPrice: 48},
"Versace Eros Parfum": {basePrice: 40, discountVolume: 5, discountPrice: 37},
"Versace Eros Pour Femme": {basePrice: 32, discountVolume: 5, discountPrice: 30},
"Versace Eros Pour Femme EDT": {basePrice: 25, discountVolume: 5, discountPrice: 23},
"Versace Man Eau Fraiche": {basePrice: 24, discountVolume: 5, discountPrice: 20},
"Versace Pour Homme": {basePrice: 24, discountVolume: 5, discountPrice: 22},
"Versace Pour Homme Oud Noir": {basePrice: 38, discountVolume: 5, discountPrice: 36},
"Versace Versense": {basePrice: 30, discountVolume: 5, discountPrice: 29},
"Versace Yellow Diamond": {basePrice: 27, discountVolume: 5, discountPrice: 24},
"Viktor & Rolf Flowerbomb": {basePrice: 40, discountVolume: 5, discountPrice: 39},
"Viktor & Rolf Good Fortune": {basePrice: 28, discountVolume: 5, discountPrice: 26},
"Viktor & Rolf Spicebomb": {basePrice: 39, discountVolume: 5, discountPrice: 38},
"Viktor & Rolf Spicebomb Dark Leather": {basePrice: 38, discountVolume: 5, discountPrice: 35},
"Viktor & Rolf Spicebomb Extreme": {basePrice: 45, discountVolume: 5, discountPrice: 43},
"Viktor & Rolf Spicebomb Infrared": {basePrice: 43, discountVolume: 5, discountPrice: 41},
"Viktor & Rolf Spicebomb Night Vision": {basePrice: 38, discountVolume: 5, discountPrice: 36},
"Xerjoff Sospiro Afgano Puro": {basePrice: 75, discountVolume: 5, discountPrice: 73},
"YSL Black Opium": {basePrice: 45, discountVolume: 5, discountPrice: 43},
"YSL Black Opium Le Parfum": {basePrice: 55, discountVolume: 5, discountPrice: 50},
"YSL La Nuit de L‚ÄôHomme": {basePrice: 35, discountVolume: 5, discountPrice: 33},
"YSL La Nuit de L‚ÄôHomme EDP": {basePrice: 42, discountVolume: 10, discountPrice: 39},
"YSL Libre": {basePrice: 37, discountVolume: 5, discountPrice: 36},
"YSL MYSLF": {basePrice: 39, discountVolume: 5, discountPrice: 36},
"YSL MYSLF Le Parfum": {basePrice: 49, discountVolume: 5, discountPrice: 48},
"YSL Y L‚ÄôElixir": {basePrice: 60, discountVolume: 5, discountPrice: 56},
"YSL Y Le Parfum": {basePrice: 47, discountVolume: 5, discountPrice: 45},
"YSL Y EDP": {basePrice: 40, discountVolume: 5, discountPrice: 38},
"YSL Y EDP Intense": {basePrice: 47, discountVolume: 5, discountPrice: 45},
"Zadig & Voltaire Just Rock! for Him": {basePrice: 40, discountVolume: 0, discountPrice: 40}, // –ë–µ–∑ –∑–Ω–∏–∂–∫–∏
"Zadig & Voltaire This Is Really Her!": {basePrice: 33, discountVolume: 5, discountPrice: 30},
"Zadig & Voltaire This Is Her!": {basePrice: 38, discountVolume: 5, discountPrice: 37},
"Zadig & Voltaire This Is Her! Vibes of Freedom": {basePrice: 39, discountVolume: 5, discountPrice: 35},
"Zadig & Voltaire This Is Him!": {basePrice: 29, discountVolume: 5, discountPrice: 26},
"Zarkoperfume Pink Molecule": {basePrice: 39, discountVolume: 5, discountPrice: 37},
"Afnan 9pm Elixir": {basePrice: 30, discountVolume: 10, discountPrice: 28},
"Afnan Rare Reef": {basePrice: 25, discountVolume: 5, discountPrice: 20},
"Ard Al Zaafaran Saheb Intense": {basePrice: 28, discountVolume: 5, discountPrice: 27},
"Gucci Guilty Elixir de Parfum pour Femme": {basePrice: 75, discountVolume: 5, discountPrice: 69},
// ===================================================================
// =================== –ö–Ü–ù–ï–¶–¨ –ù–û–í–ò–• –ü–ê–†–§–£–ú–Ü–í =========================
// ===================================================================
        };

        // --- CORE FUNCTIONS (LOAD/SAVE) ---
        function loadPerfumePrices() { PERFUME_PRICES = JSON.parse(localStorage.getItem(CONFIG_KEYS.PRICES)) || INITIAL_PRICES; }
        function loadFlaconData() { 
            FLACON_VOLUMES = JSON.parse(localStorage.getItem(CONFIG_KEYS.VOLUMES)) || FLACON_VOLUMES;
            FLACON_COSTS = JSON.parse(localStorage.getItem(CONFIG_KEYS.FLACONS)) || FLACON_COSTS;
        }
        function loadMarkupPresets() { MARKUP_PRESETS = JSON.parse(localStorage.getItem(CONFIG_KEYS.MARKUPS)) || MARKUP_PRESETS; }
        function loadSalesSources() { SALES_SOURCES = JSON.parse(localStorage.getItem(CONFIG_KEYS.SOURCES)) || SALES_SOURCES; }
        function getTransactions() { return JSON.parse(localStorage.getItem(CONFIG_KEYS.TRANSACTIONS)) || []; }
        function saveTransactions(txs) { localStorage.setItem(CONFIG_KEYS.TRANSACTIONS, JSON.stringify(txs)); }
        function getExpenses() { return JSON.parse(localStorage.getItem(CONFIG_KEYS.EXPENSES)) || []; }
        function saveExpenses(exps) { localStorage.setItem(CONFIG_KEYS.EXPENSES, JSON.stringify(exps)); }

        // --- UI HELPERS ---
        function showToast(message, type = 'default') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<i class="fa-solid fa-bell"></i> <span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        window.showSection = function(sectionId, element) {
            document.querySelectorAll('.content-section').forEach(s => s.style.display = 'none');
            document.getElementById(sectionId).style.display = 'block';

            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            if(element) element.classList.add('active');

            if (sectionId === 'transactions') renderTransactionHistory();
            if(sectionId === 'admin-panel') { renderPerfumeList(); }
            if(sectionId === 'expenses') renderExpenseList();
            if (sectionId === 'crm-management') renderClientList(); // –î–æ–¥–∞–Ω–æ –≤–∏–∫–ª–∏–∫
            if (sectionId === 'analytics-dashboard') renderAnalyticsCharts(); // –î–æ–¥–∞–Ω–æ –≤–∏–∫–ª–∏–∫
        }

        // --- FORM HELPERS (UPDATED for CRM) ---
        window.populateFormOptions = function() {
            const perfumePrices = PERFUME_PRICES;
            const flaconData = FLACON_COSTS;
            const salesSources = SALES_SOURCES;

            // Volumes
            const volSelects = ['flaconVolume', 'orderFlaconVolume', 'calcFlaconVolume', 'adminFlaconVolume'];
            volSelects.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.innerHTML = '<option value="" disabled selected>–û–±\'—î–º</option>';
                    FLACON_VOLUMES.sort((a,b) => a-b).forEach(v => {
                        const opt = document.createElement('option');
                        opt.value = v;
                        opt.text = `${v} –º–ª (${flaconData[v] || 0} –≥—Ä–Ω)`;
                        el.appendChild(opt);
                    });
                }
            });

            // Markups
            const markupSelects = ['saleMarkupTierSingle', 'saleMarkupTierOrder', 'calcMarkupTier', 'priceListMarkup'];
            markupSelects.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.innerHTML = '';
                    Object.keys(MARKUP_PRESETS).forEach(k => {
                        const opt = document.createElement('option');
                        opt.value = k;
                        opt.text = `${k} (${(MARKUP_PRESETS[k]*100).toFixed(0)}%)`;
                        el.appendChild(opt);
                    });
                }
            });

            // Sources
            const sourceSelects = ['saleSourceSingle', 'saleSourceOrder', 'historyFilterSource'];
            sourceSelects.forEach(id => {
                const el = document.getElementById(id);
                if(el) {
                    el.innerHTML = id.includes('Filter') ? '<option value="">–í—Å—ñ –¥–∂–µ—Ä–µ–ª–∞</option>' : '';
                    SALES_SOURCES.forEach(s => {
                        const opt = document.createElement('option');
                        opt.value = s;
                        opt.text = s;
                        el.appendChild(opt);
                    });
                }
            });

            // Datalists: PERFUMES (FIXED)
            const pList = document.getElementById('perfumeList');
            if (pList) {
                pList.innerHTML = '';
                Object.keys(perfumePrices).sort().forEach(n => {
                    const opt = document.createElement('option');
                    opt.value = n;
                    pList.appendChild(opt);
                });
            }

            // Datalists: CLIENTS (FIXED)
            const cList = document.getElementById('clientList');
            if (cList) {
                cList.innerHTML = '';
                const clientsFromHistory = new Set(getTransactions().map(t => t.clientName).filter(n => n && n !== '---'));
                const clientsFromCRM = Object.keys(getClients());
                const allClients = new Set([...clientsFromHistory, ...clientsFromCRM]);

                Array.from(allClients).sort().forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c;
                    cList.appendChild(opt);
                });
            }
        }
        
        // --- CALCULATION LOGIC ---
        function calculateCost(perfumeName, quantityML, markupTier) {
            const pData = PERFUME_PRICES[perfumeName];
            const flaconCost = FLACON_COSTS[quantityML];
            const markup = MARKUP_PRESETS[markupTier];

            if (!pData || isNaN(flaconCost) || isNaN(markup)) return null;

            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –°/–° –∑–∞ –º–ª
            let costPerML = pData.basePrice;
            if (quantityML >= pData.discountVolume && pData.discountVolume > 0) {
                costPerML = pData.discountPrice;
            }

            // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Å–æ–±—ñ–≤–∞—Ä—Ç–æ—Å—Ç—ñ
            const costPerfume = costPerML * quantityML;
            const costTotal = costPerfume + flaconCost;

            // –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ü—ñ–Ω–∏ –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞
            const retailPricePerML = pData.basePrice * (1 + markup); // –†–æ–∑–¥—Ä—ñ–±–Ω–∞ —Ü—ñ–Ω–∞ –±–∞–∑—É—î—Ç—å—Å—è –Ω–∞ basePrice
            const revenuePerfume = retailPricePerML * quantityML;
            const revenueTotal = revenuePerfume + flaconCost;

            // –ü—Ä–∏–±—É—Ç–æ–∫
            const profit = revenueTotal - costTotal;

            return {
                costPerML: costPerML,
                costFlacon: flaconCost,
                costPerfume: costPerfume,
                costTotal: parseFloat(costTotal.toFixed(2)),
                revenue: parseFloat(revenueTotal.toFixed(2)),
                profit: parseFloat(profit.toFixed(2))
            };
        }

        window.updateDashboard = function() {
            const today = new Date().toISOString().split('T')[0];
            const transactions = getTransactions();
            
            const todayStats = transactions.filter(t => new Date(t.timestamp).toISOString().split('T')[0] === today)
                .reduce((acc, t) => {
                    acc.revenue += t.revenue;
                    acc.profit += t.profit;
                    acc.count += 1;
                    return acc;
                }, { revenue: 0, profit: 0, count: 0 });

            document.getElementById('dash-revenue').textContent = `${todayStats.revenue.toFixed(2)} ‚Ç¥`;
            document.getElementById('dash-profit').textContent = `${todayStats.profit.toFixed(2)} ‚Ç¥`;
            document.getElementById('dash-count').textContent = todayStats.count;
        }


        // --- ACTIONS: SALE ---
        window.addSale = function() {
            const name = document.getElementById('perfumeName').value.trim();
            const vol = parseFloat(document.getElementById('flaconVolume').value);
            const markup = document.getElementById('saleMarkupTierSingle').value;
            const source = document.getElementById('saleSourceSingle').value;
            const client = document.getElementById('clientNameSingle').value.trim();

            if(!name || isNaN(vol) || !markup) {
                showToast("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É, –æ–±'—î–º —Ç–∞ –Ω–∞—Ü—ñ–Ω–∫—É", "error");
                return;
            }

            const calc = calculateCost(name, vol, markup);
            if(!calc) {
                showToast("–ü–∞—Ä—Ñ—É–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –±–∞–∑—ñ!", "error");
                return;
            }

            const tx = {
                id: Date.now(),
                timestamp: Date.now(),
                clientName: client || '---',
                source: source,
                markupTier: markup,
                perfumeName: name,
                quantityML: vol,
                revenue: calc.revenue,
                profit: calc.profit,
                costTotal: calc.costTotal
            };
            
            const txs = getTransactions();
            txs.push(tx);
            saveTransactions(txs);

            showToast(`–ü—Ä–æ–¥–∞–Ω–æ: ${name} (${calc.revenue} ‚Ç¥)`, "success");
            showModalReceipt([tx], calc.revenue, client);

            document.getElementById('perfumeName').value = '';
            document.getElementById('clientNameSingle').value = '';
            document.getElementById('flaconVolume').value = '';
            
            updateDashboard();
            populateFormOptions(); // –û–Ω–æ–≤–ª–µ–Ω–Ω—è datalist –∫–ª—ñ—î–Ω—Ç—ñ–≤
        }

        // --- ACTIONS: ORDER ---
        window.addItemToOrder = function() {
            const name = document.getElementById('orderPerfumeName').value.trim();
            const vol = parseFloat(document.getElementById('orderFlaconVolume').value);
            const markup = document.getElementById('saleMarkupTierOrder').value;

            if(!name || isNaN(vol) || !markup) {
                showToast("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –Ω–∞–∑–≤—É, –æ–±'—î–º —Ç–∞ –Ω–∞—Ü—ñ–Ω–∫—É –¥–ª—è –ø–æ–∑–∏—Ü—ñ—ó", "error");
                return;
            }

            const calc = calculateCost(name, vol, markup);
            if(!calc) {
                showToast("–ü–∞—Ä—Ñ—É–º –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ", "error");
                return;
            }

            CURRENT_ORDER_LIST.push({ 
                ...calc, 
                name, 
                vol, 
                markup,
                id: Date.now() + Math.random() // –¢–∏–º—á–∞—Å–æ–≤–∏–π ID –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è
            });
            renderOrderList();
            document.getElementById('orderPerfumeName').value = '';
            document.getElementById('orderFlaconVolume').value = '';
            showToast("–ü–æ–∑–∏—Ü—ñ—é –¥–æ–¥–∞–Ω–æ –¥–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è", "warning");
        }

        window.renderOrderList = function() {
            const tbody = document.querySelector('#order-list-table tbody');
            tbody.innerHTML = '';
            let total = 0;
            let totalCost = 0;
            const summaryEl = document.getElementById('orderSummaryOutput');
            let summaryText = '';

            if (CURRENT_ORDER_LIST.length > 0) {
                summaryText = "–í–∞—à–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:\n";
            }

            CURRENT_ORDER_LIST.forEach((item, idx) => {
                total += item.revenue;
                totalCost += item.costTotal;
                tbody.innerHTML += `
                    <tr>
                        <td>${item.name}</td>
                        <td class="text-right">${item.vol} –º–ª</td>
                        <td class="text-right">${item.revenue.toFixed(2)} ‚Ç¥</td>
                        <td class="text-right"><button class="btn-danger btn-sm" onclick="removeItemFromOrder(${item.id})"><i class="fa-solid fa-xmark"></i></button></td>
                    </tr>
                `;
                summaryText += `- ${item.name} (${item.vol} –º–ª) - ${item.revenue.toFixed(2)} ‚Ç¥\n`;
            });
            
            summaryText += `\n–í—Å—å–æ–≥–æ: ${total.toFixed(2)} ‚Ç¥`;
            summaryEl.value = summaryText;

            document.getElementById('orderTotalSection').textContent = `–í—Å—å–æ–≥–æ –¥–æ —Å–ø–ª–∞—Ç–∏: ${total.toFixed(2)} ‚Ç¥`;
        }

        window.removeItemFromOrder = function(id) {
            CURRENT_ORDER_LIST = CURRENT_ORDER_LIST.filter(item => item.id !== id);
            renderOrderList();
        }

        window.processOrder = function() {
            if (CURRENT_ORDER_LIST.length === 0) {
                showToast("–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π!", "error");
                return;
            }

            const client = document.getElementById('clientNameOrder').value.trim();
            const source = document.getElementById('saleSourceOrder').value;
            const markup = document.getElementById('saleMarkupTierOrder').value;
            const totalRevenue = CURRENT_ORDER_LIST.reduce((acc, item) => acc + item.revenue, 0);

            const transactions = CURRENT_ORDER_LIST.map(item => ({
                id: Date.now() + Math.random(),
                timestamp: Date.now(),
                clientName: client || '---',
                source: source,
                markupTier: markup,
                perfumeName: item.name,
                quantityML: item.vol,
                revenue: item.revenue,
                profit: item.profit,
                costTotal: item.costTotal
            }));

            const txs = getTransactions();
            txs.push(...transactions);
            saveTransactions(txs);

            showToast(`–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ ${totalRevenue.toFixed(2)} ‚Ç¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–æ!`, "success");
            showModalReceipt(CURRENT_ORDER_LIST.map(item => ({...item, quantityML: item.vol})), totalRevenue, client);
            clearOrder();
            updateDashboard();
            populateFormOptions(); // –û–Ω–æ–≤–ª–µ–Ω–Ω—è datalist –∫–ª—ñ—î–Ω—Ç—ñ–≤
        }

        window.clearOrder = function() {
            CURRENT_ORDER_LIST = [];
            renderOrderList();
            document.getElementById('clientNameOrder').value = '';
        }

        // Copy Order Summary
        window.copyOrderSummary = function() {
            const outputEl = document.getElementById('orderSummaryOutput');
            if (outputEl.value) {
                outputEl.select();
                navigator.clipboard.writeText(outputEl.value).then(() => {
                    showToast("‚úÖ –¢–µ–∫—Å—Ç –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ!", "success");
                }).catch(err => {
                    showToast("–ü–æ–º–∏–ª–∫–∞ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è. –°–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É.", "error");
                });
            } else {
                showToast("–ù–µ–º–∞—î –ø–æ–∑–∏—Ü—ñ–π —É –∑–∞–º–æ–≤–ª–µ–Ω–Ω—ñ.", "error");
            }
        }

        // --- HISTORY & REPORT ---
        window.generateReport = function() {
            const start = document.getElementById('startDate').value;
            const end = document.getElementById('endDate').value;

            if (!start || !end) {
                showToast("–û–±–µ—Ä—ñ—Ç—å –ø–æ—á–∞—Ç–∫–æ–≤—É —Ç–∞ –∫—ñ–Ω—Ü–µ–≤—É –¥–∞—Ç—É.", "error");
                return;
            }

            const startTime = new Date(start).getTime();
            const endTime = new Date(end).getTime() + 86400000; // –î–æ–¥–∞—î–º–æ 1 –¥–µ–Ω—å

            const txs = getTransactions().filter(t => t.timestamp >= startTime && t.timestamp < endTime);
            const exps = getExpenses().filter(e => e.timestamp >= startTime && e.timestamp < endTime);

            const totalRevenue = txs.reduce((a, b) => a + b.revenue, 0);
            const totalProfit = txs.reduce((a, b) => a + b.profit, 0);
            const totalExpenses = exps.reduce((a, b) => a + b.amount, 0);
            const netProfit = totalProfit - totalExpenses;
            
            const salesByPerfume = txs.reduce((acc, t) => {
                acc[t.perfumeName] = (acc[t.perfumeName] || 0) + t.quantityML;
                return acc;
            }, {});

            let reportHTML = `
                <div class="card" style="padding: 15px; background: var(--white);">
                    <h3>–ó–≤—ñ—Ç –∑–∞ –ø–µ—Ä—ñ–æ–¥: ${start} ‚Äî ${end}</h3>
                    <table class="data-table" style="margin-bottom: 20px; min-width: auto;">
                        <tr><td>üí∞ –ó–∞–≥–∞–ª—å–Ω–∞ –≤–∏—Ä—É—á–∫–∞:</td><td class="text-right text-bold">${totalRevenue.toFixed(2)} ‚Ç¥</td></tr>
                        <tr><td>‚úÖ –ó–∞–≥–∞–ª—å–Ω–∏–π –≤–∞–ª–æ–≤–∏–π –ø—Ä–∏–±—É—Ç–æ–∫:</td><td class="text-right text-bold text-success">${totalProfit.toFixed(2)} ‚Ç¥</td></tr>
                        <tr><td>üí∏ –ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏:</td><td class="text-right text-bold text-danger">${totalExpenses.toFixed(2)} ‚Ç¥</td></tr>
                        <tr><td>üî• –ß–∏—Å—Ç–∏–π –ø—Ä–∏–±—É—Ç–æ–∫ (–í–∞–ª–æ–≤–∏–π - –í–∏—Ç—Ä–∞—Ç–∏):</td><td class="text-right text-bold" style="font-size: 1.1rem; color: ${netProfit >= 0 ? 'var(--secondary)' : 'var(--danger)'}">${netProfit.toFixed(2)} ‚Ç¥</td></tr>
                    </table>
                    
                    <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—å –ø–∞—Ä—Ñ—É–º—ñ–≤ (–º–ª)</h3>
                    <ul>
                        ${Object.entries(salesByPerfume).sort(([, a], [, b]) => b - a).map(([name, vol]) => `<li>${name}: ${vol.toFixed(1)} –º–ª</li>`).join('')}
                    </ul>
                </div>
            `;
            document.getElementById('reportOutput').innerHTML = reportHTML;
        }

        window.renderTransactionHistory = function() {
            const search = document.getElementById('transactionSearch').value.toLowerCase();
            const sourceFilter = document.getElementById('historyFilterSource').value;
            const dateFilter = document.getElementById('historyStartDate').value;
            const tbody = document.querySelector('#transaction-history-table tbody');
            tbody.innerHTML = '';
            
            let txs = getTransactions().sort((a,b) => b.timestamp - a.timestamp);
            let filteredCount = 0;
            let totalRev = 0;
            let totalProf = 0;

            txs.forEach(t => {
                if(search && !t.perfumeName.toLowerCase().includes(search) && !t.clientName.toLowerCase().includes(search)) return;
                if(sourceFilter && t.source !== sourceFilter) return;
                if(dateFilter) {
                    const txDate = new Date(t.timestamp).toISOString().split('T')[0];
                    if(txDate !== dateFilter) return;
                }

                filteredCount++;
                totalRev += t.revenue;
                totalProf += t.profit;

                tbody.innerHTML += `
                    <tr>
                        <td>${new Date(t.timestamp).toLocaleDateString()}</td>
                        <td>${t.clientName}</td>
                        <td style="font-size: 0.8rem; color: gray;">${t.source}</td>
                        <td>${t.perfumeName} (${t.quantityML} –º–ª)</td>
                        <td class="text-right text-bold">${t.revenue.toFixed(2)}</td>
                        <td class="text-right ${t.profit >= 0 ? 'text-success' : 'text-danger'}">${t.profit.toFixed(1)}</td>
                        <td class="text-right"><button class="btn-danger btn-sm" onclick="deleteTx(${t.id})"><i class="fa-solid fa-trash"></i></button></td>
                    </tr>
                `;
            });
            document.getElementById('transactionSummary').innerHTML = `–ó–∞–ø–∏—Å—ñ–≤: ${filteredCount} | –í–∏—Ä—É—á–∫–∞: ${totalRev.toFixed(2)} ‚Ç¥ | –ü—Ä–∏–±—É—Ç–æ–∫: ${totalProf.toFixed(2)} ‚Ç¥`;
        }

        window.deleteTx = function(id) {
            if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ –∑–∞–ø–∏—Å?")) return;
            let txs = getTransactions().filter(t => t.id !== id);
            saveTransactions(txs);
            renderTransactionHistory();
            updateDashboard();
            showToast("–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é –≤–∏–¥–∞–ª–µ–Ω–æ.", "error");
        }

        // --- ADMIN PANEL & CONFIG ---
        window.clearAllData = function() {
            if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –í–°–Ü –î–ê–ù–Ü (—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó, –ø–∞—Ä—Ñ—É–º–∏, –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è) –ë–£–î–£–¢–¨ –í–ò–î–ê–õ–ï–ù–Ü!")) {
                localStorage.clear();
                window.location.reload();
            }
        }

        window.resetDefaultData = function() {
            if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –ë—É–¥—É—Ç—å –≤–∏–¥–∞–ª–µ–Ω—ñ –í–°–Ü –í–ê–®–Ü –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø —Ç–∞ –ü–†–ê–ô–°-–õ–ò–°–¢, –∞–ª–µ —ñ—Å—Ç–æ—Ä—ñ—è –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑–±–µ—Ä–µ–∂–µ—Ç—å—Å—è!")) {
                localStorage.removeItem(CONFIG_KEYS.PRICES);
                localStorage.removeItem(CONFIG_KEYS.VOLUMES);
                localStorage.removeItem(CONFIG_KEYS.FLACONS);
                localStorage.removeItem(CONFIG_KEYS.MARKUPS);
                localStorage.removeItem(CONFIG_KEYS.SOURCES);
                window.location.reload();
            }
        }

        // Add or Update Perfume
        window.addOrUpdatePerfume = function() {
            const name = document.getElementById('adminPerfumeName').value.trim();
            const basePrice = parseFloat(document.getElementById('adminBasePrice').value);
            let discountVolume = parseFloat(document.getElementById('adminDiscountVolume').value) || 0;
            const discountPrice = parseFloat(document.getElementById('adminDiscountPrice').value) || basePrice;

            if(!name || isNaN(basePrice) || basePrice <= 0) {
                showToast("–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –±–∞–∑–æ–≤—É –°/–°!", "error");
                return;
            }
            
            // –ó–∞–±–µ–∑–ø–µ—á—É—î–º–æ, —â–æ discountPrice –Ω–µ –ø–µ—Ä–µ–≤–∏—â—É—î basePrice
            const finalDiscountPrice = Math.min(basePrice, discountPrice);

            PERFUME_PRICES[name] = {
                basePrice: basePrice,
                discountVolume: discountVolume,
                discountPrice: finalDiscountPrice
            };
            localStorage.setItem(CONFIG_KEYS.PRICES, JSON.stringify(PERFUME_PRICES));
            renderPerfumeList();
            populateFormOptions();
            showToast("–ü–∞—Ä—Ñ—É–º –∑–±–µ—Ä–µ–∂–µ–Ω–æ!", "success");

            // Clear inputs after save, reset discount volume to default
            document.getElementById('adminPerfumeName').value = '';
            document.getElementById('adminBasePrice').value = '';
            document.getElementById('adminDiscountVolume').value = '5';
            document.getElementById('adminDiscountPrice').value = '';
        }

        // Render Perfume List
        window.renderPerfumeList = function() {
            const search = document.getElementById('perfumeSearchInput').value.toLowerCase();
            const tbody = document.querySelector('#perfume-list-table tbody');
            tbody.innerHTML = '';
            
            Object.entries(PERFUME_PRICES).sort().forEach(([name, data]) => {
                if(search && !name.toLowerCase().includes(search)) return;
                tbody.innerHTML += `
                    <tr>
                        <td>${name}</td>
                        <td class="text-right">${data.basePrice} ‚Ç¥/–º–ª${data.discountVolume > 0 ? ` (<i class="fa-solid fa-tag"></i> ${data.discountPrice} –∑–∞ >${data.discountVolume} –º–ª)` : ''}</td>
                        <td class="text-right">
                            <button class="btn-warning btn-sm" onclick="editPerfume('${name}')"><i class="fa-solid fa-edit"></i></button>
                            <button class="btn-danger btn-sm" onclick="deletePerfume('${name}')"><i class="fa-solid fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });
        }

        window.editPerfume = function(name) {
            const data = PERFUME_PRICES[name];
            if (!data) return;
            document.getElementById('adminPerfumeName').value = name;
            document.getElementById('adminBasePrice').value = data.basePrice;
            document.getElementById('adminDiscountVolume').value = data.discountVolume;
            document.getElementById('adminDiscountPrice').value = data.discountPrice;
            showToast(`–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è: ${name}`, "warning");
        }

        window.deletePerfume = function(name) {
            if(!confirm("–í–∏–¥–∞–ª–∏—Ç–∏ " + name + "?")) return;
            delete PERFUME_PRICES[name];
            localStorage.setItem(CONFIG_KEYS.PRICES, JSON.stringify(PERFUME_PRICES));
            renderPerfumeList();
            populateFormOptions();
            showToast("–ü–∞—Ä—Ñ—É–º –≤–∏–¥–∞–ª–µ–Ω–æ!", "error");
        }
        
        // Add or Update Flacon
        window.addOrUpdateFlacon = function() {
            const vol = parseFloat(document.getElementById('adminFlaconVolume').value);
            const cost = parseFloat(document.getElementById('adminFlaconCost').value);

            if(isNaN(vol) || isNaN(cost) || vol <= 0) {
                showToast("–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –æ–±'—î–º —Ç–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å —Ñ–ª–∞–∫–æ–Ω—É.", "error");
                return;
            }

            FLACON_COSTS[vol] = cost;
            if(!FLACON_VOLUMES.includes(vol)) {
                FLACON_VOLUMES.push(vol);
                FLACON_VOLUMES.sort((a,b) => a-b);
                localStorage.setItem(CONFIG_KEYS.VOLUMES, JSON.stringify(FLACON_VOLUMES));
            }
            localStorage.setItem(CONFIG_KEYS.FLACONS, JSON.stringify(FLACON_COSTS));
            populateFormOptions();
            showToast(`–§–ª–∞–∫–æ–Ω ${vol} –º–ª –∑–±–µ—Ä–µ–∂–µ–Ω–æ!`, "success");

            document.getElementById('adminFlaconVolume').value = '';
            document.getElementById('adminFlaconCost').value = '';
        }

        // Add or Update Markup Preset
        window.addOrUpdateMarkupPreset = function() {
            const name = document.getElementById('adminMarkupName').value.trim();
            const value = parseFloat(document.getElementById('adminMarkupValue').value);

            if(!name || isNaN(value) || value < 0) {
                showToast("–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ –∫–æ—Ä–µ–∫—Ç–Ω–∏–π –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç –Ω–∞—Ü—ñ–Ω–∫–∏ (–Ω–∞–ø—Ä. 0.10).", "error");
                return;
            }

            MARKUP_PRESETS[name] = value;
            localStorage.setItem(CONFIG_KEYS.MARKUPS, JSON.stringify(MARKUP_PRESETS));
            populateFormOptions();
            showToast(`–ù–∞—Ü—ñ–Ω–∫—É "${name}" –æ–Ω–æ–≤–ª–µ–Ω–æ!`, "success");
            
            document.getElementById('adminMarkupName').value = '';
            document.getElementById('adminMarkupValue').value = '';
        }

        // Generate Price List
        window.generatePriceList = function() {
            const markupName = document.getElementById('priceListMarkup').value;
            const markup = MARKUP_PRESETS[markupName];
            if (!markup) {
                showToast("–í–∏–±–µ—Ä—ñ—Ç—å –Ω–∞—Ü—ñ–Ω–∫—É!", "error");
                return;
            }

            let priceListText = `–ü—Ä–∞–π—Å-–ª–∏—Å—Ç "PerfumeFlow" (${markupName}):\n\n`;
            
            const perfumeNames = Object.keys(PERFUME_PRICES).sort();
            perfumeNames.forEach(name => {
                const pData = PERFUME_PRICES[name];
                // Calculate the FIXED retail price per ML (without flacon)
                let retailPriceStandard = pData.basePrice * (1 + markup);
                let priceLine = `‚ú® ${name}: ${retailPriceStandard.toFixed(2)} ‚Ç¥/–º–ª`;
                priceListText += priceLine + `\n`;
            });

            // Add flacon cost info
            priceListText += `\n--- üß¥ –í–∞—Ä—Ç—ñ—Å—Ç—å –ø–æ—Ä–æ–∂–Ω—ñ—Ö —Ñ–ª–∞–∫–æ–Ω—ñ–≤ (–¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ —Ü—ñ–Ω–∏ –ø–∞—Ä—Ñ—É–º—É) ---\n`;
            FLACON_VOLUMES.sort((a,b)=>a-b).forEach(vol => {
                priceListText += `* ${vol} –º–ª: ${FLACON_COSTS[vol]} ‚Ç¥\n`;
            });

            document.getElementById('priceListOutput').value = priceListText;
            showToast("–ü—Ä–∞–π—Å-–ª–∏—Å—Ç —Å—Ñ–æ—Ä–º–æ–≤–∞–Ω–æ. –°–∫–æ–ø—ñ—é–π—Ç–µ –π–æ–≥–æ.", "warning");
        }

        // Price Calculator
        window.calculatePrice = function() {
            const name = document.getElementById('calcPerfumeName').value.trim();
            const vol = parseFloat(document.getElementById('calcFlaconVolume').value);
            const markup = document.getElementById('calcMarkupTier').value;
            const el = document.getElementById('calculatorOutput');

            if (!name || isNaN(vol) || !markup) {
                el.innerHTML = "";
                return;
            }

            const res = calculateCost(name, vol, markup);
            
            if (res) {
                el.innerHTML = `
                    <div class="stat-card green" style="text-align:center">
                        <h3>–¶—ñ–Ω–∞ –¥–ª—è –∫–ª—ñ—î–Ω—Ç–∞</h3>
                        <div class="value">${res.revenue} ‚Ç¥</div>
                        <small>–í–∞–ª–æ–≤–∞ –°/–°: ${res.costTotal.toFixed(2)} ‚Ç¥ | –ü—Ä–∏–±—É—Ç–æ–∫: ${res.profit.toFixed(2)} ‚Ç¥</small>
                    </div>
                `;
            } else {
                el.innerHTML = "<div class='card' style='border-left: 5px solid var(--danger);'>–ü–æ–º–∏–ª–∫–∞ –¥–∞–Ω–∏—Ö. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –æ–±—Ä–∞–Ω—ñ –≤—Å—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ —Ç–∞ —á–∏ —ñ—Å–Ω—É—î –ø–∞—Ä—Ñ—É–º –≤ –±–∞–∑—ñ.</div>";
            }
        }

        // Expenses Logic
        window.addExpense = function() {
            const d = document.getElementById('expenseDescription').value;
            const a = parseFloat(document.getElementById('expenseAmount').value);

            if(!d || isNaN(a) || a <= 0) {
                showToast("–í–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å —Ç–∞ —Å—É–º—É –≤–∏—Ç—Ä–∞—Ç–∏.", "error");
                return;
            }

            const exps = getExpenses();
            exps.push({ id: Date.now(), timestamp: Date.now(), description: d, amount: a });
            saveExpenses(exps);
            
            renderExpenseList();
            showToast("–í–∏—Ç—Ä–∞—Ç—É –¥–æ–¥–∞–Ω–æ!", "success");

            document.getElementById('expenseDescription').value = '';
            document.getElementById('expenseAmount').value = '';
        }

        window.renderExpenseList = function() {
            const tbody = document.querySelector('#expense-list-table tbody');
            tbody.innerHTML = '';
            
            getExpenses().sort((a,b) => b.timestamp - a.timestamp).forEach(e => {
                tbody.innerHTML += `
                    <tr>
                        <td>${new Date(e.timestamp).toLocaleDateString()}</td>
                        <td>${e.description}</td>
                        <td class="text-right text-bold text-danger">${e.amount.toFixed(2)} ‚Ç¥</td>
                        <td class="text-right"><button class="btn-danger btn-sm" onclick="deleteExpense(${e.id})"><i class="fa-solid fa-trash"></i></button></td>
                    </tr>
                `;
            });
        }

        window.deleteExpense = function(id) {
            saveExpenses(getExpenses().filter(e => e.id !== id));
            renderExpenseList();
            showToast("–í–∏—Ç—Ä–∞—Ç—É –≤–∏–¥–∞–ª–µ–Ω–æ.", "error");
        }


        // ====================================================================================
        // === –ù–û–í–Ü –§–£–ù–ö–¶–Ü–á –î–õ–Ø CRM (3), –ê–ù–ê–õ–Ü–¢–ò–ö–ò (4) ===
        // ====================================================================================

        // --- 3. –†–û–ó–®–ò–†–ï–ù–ò–ô CRM: –õ–û–ì–Ü–ö–ê ---
        function getClients() {
            return JSON.parse(localStorage.getItem('clients_data')) || {};
        }

        function saveClients(clients) {
            localStorage.setItem('clients_data', JSON.stringify(clients));
        }

        window.addUpdateClient = function(name, phone, email, dob) {
            if (!name) return showToast("–Ü–º'—è –∫–ª—ñ—î–Ω—Ç–∞ —î –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–º.", "error");

            const clients = getClients();
            
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ, —è–∫—â–æ –Ω–æ–≤—ñ –ø–æ—Ä–æ–∂–Ω—ñ
            clients[name] = { 
                name, 
                phone: phone || clients[name]?.phone || '', 
                email: email || clients[name]?.email || '', 
                dob: dob || clients[name]?.dob || '' 
            };
            saveClients(clients);
            renderClientList();
            showToast(`–ö–ª—ñ—î–Ω—Ç–∞ ${name} –∑–±–µ—Ä–µ–∂–µ–Ω–æ/–æ–Ω–æ–≤–ª–µ–Ω–æ!`, "success");
            
            // –û—á–∏—Å—Ç–∏—Ç–∏ –ø–æ–ª—è –ø—ñ—Å–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
            document.getElementById('newClientName').value = '';
            document.getElementById('newClientPhone').value = '';
            document.getElementById('newClientEmail').value = '';
            document.getElementById('newClientDOB').value = '';

            // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –∫–ª—ñ—î–Ω—Ç—ñ–≤ –¥–ª—è datalist
            populateFormOptions();
        }

        window.renderClientList = function() {
            const clients = getClients();
            const transactions = getTransactions();
            const tb = document.querySelector('#clientListTable tbody');
            if (!tb) return;
            tb.innerHTML = '';

            // –ê–≥—Ä–µ–≥–∞—Ü—ñ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
            const clientStats = transactions.reduce((acc, t) => {
                const name = t.clientName ? t.clientName.trim() : null;
                if (!name || name === '---') return acc;
                acc[name] = acc[name] || { count: 0, revenue: 0 };
                acc[name].count += 1;
                acc[name].revenue += t.revenue;
                return acc;
            }, {});

            // –û–±'—î–¥–Ω—É—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            const allClientNames = new Set([...Object.keys(clients), ...Object.keys(clientStats)]);

            Array.from(allClientNames).sort().forEach(name => {
                const client = clients[name] || {};
                const stats = clientStats[name] || { count: 0, revenue: 0 };
                
                tb.innerHTML += `
                    <tr>
                        <td>${name}</td>
                        <td>${client.phone || '-'}</td>
                        <td>${client.email || '-'}</td>
                        <td>${stats.count}</td>
                        <td class="text-right">${stats.revenue.toFixed(2)} ‚Ç¥</td>
                    </tr>
                `;
            });
        }
        // ----------------------------------------------------------------------


        // --- 4. –ê–ù–ê–õ–Ü–¢–ò–ö–ê: –õ–û–ì–Ü–ö–ê –†–ï–ù–î–ï–†–ò–ù–ì–£ –ì–†–ê–§–Ü–ö–Ü–í ---
        let revenueChartInstance = null;
        let topPerfumeChartInstance = null;
        
        window.renderAnalyticsCharts = function() {
            const transactions = getTransactions();

            // 1. Summary Stats
            const totalProfit = transactions.reduce((acc, t) => acc + (t.profit || 0), 0);
            document.getElementById('totalProfitCard').textContent = `${totalProfit.toFixed(2)} ‚Ç¥`;
            document.getElementById('totalTransactionsCard').textContent = transactions.length;
            
            // –Ø–∫—â–æ –≥—Ä–∞—Ñ—ñ–∫–∏ –≤–∂–µ —ñ—Å–Ω—É—é—Ç—å, –∑–Ω–∏—â—É—î–º–æ —ó—Ö –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
            if (revenueChartInstance) revenueChartInstance.destroy();
            if (topPerfumeChartInstance) topPerfumeChartInstance.destroy();
            
            if (transactions.length === 0) return;

            // 2. Daily Revenue Data (Last 30 Days)
            const today = new Date();
            const dailyRevenue = {};
            const labels = [];
            
            // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateKey = date.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit' });
                labels.push(dateKey);
                dailyRevenue[dateKey] = 0;
            }

            transactions.forEach(t => {
                const transactionDate = new Date(t.timestamp);
                const dateKey = transactionDate.toLocaleDateString('uk-UA', { day: '2-digit', month: '2-digit' });
                if (dailyRevenue.hasOwnProperty(dateKey)) {
                    dailyRevenue[dateKey] = (dailyRevenue[dateKey] || 0) + (t.revenue || 0);
                }
            });

            const revenueData = labels.map(key => dailyRevenue[key]);

            // 3. Top Perfume Data
            const perfumeSales = {};
            transactions.forEach(t => {
                if (t.perfumeName && t.quantityML) {
                    perfumeSales[t.perfumeName] = (perfumeSales[t.perfumeName] || 0) + (t.quantityML || 0);
                }
            });

            const topPerfumes = Object.entries(perfumeSales)
                .sort(([, a], [, b]) => b - a)
                .slice(0, 5);
            
            const perfumeLabels = topPerfumes.map(item => item[0]);
            const perfumeData = topPerfumes.map(item => item[1]);

            // 4. Render Revenue Chart
            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                revenueChartInstance = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '–í–∏—Ä—É—á–∫–∞ (‚Ç¥)',
                            data: revenueData,
                            borderColor: 'var(--secondary)',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            fill: true,
                            tension: 0.2
                        }]
                    },
                    options: { 
                        responsive: true, 
                        maintainAspectRatio: false, 
                        scales: { 
                            y: { beginAtZero: true },
                            x: { reverse: true } // –î–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–æ
                        } 
                    }
                });
            }

            // 5. Render Top Perfume Chart
            const topPerfumeCtx = document.getElementById('topPerfumeChart');
            if (topPerfumeCtx) {
                topPerfumeChartInstance = new Chart(topPerfumeCtx, {
                    type: 'bar',
                    data: {
                        labels: perfumeLabels,
                        datasets: [{
                            label: '–û–±—Å—è–≥ –ø—Ä–æ–¥–∞–∂—É (–º–ª)',
                            data: perfumeData,
                            backgroundColor: ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#6B7280'],
                            borderWidth: 1
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
                });
            }
        }
        // ----------------------------------------------------------------------


        // CRM Logic (Original)
        window.showClientHistory = function() {
             const name = document.getElementById('clientSearchInput').value.toLowerCase().trim();
             if (!name) return;
             const trs = getTransactions().filter(t => t.clientName.toLowerCase() === name);
             
             let totalRevenue = trs.reduce((a,b) => a+b.revenue, 0);
             let totalProfit = trs.reduce((a,b) => a+b.profit, 0);
             
             document.getElementById('clientCrmSummary').innerHTML = `<div class="stat-card green" style="background: var(--primary);"><h3 style="color:white; margin-bottom: 5px;">–ü–æ–∫—É–ø–æ–∫: ${trs.length}</h3><h3 style="color:white;">–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∏—Ä—É—á–∫–∞: ${totalRevenue.toFixed(2)} ‚Ç¥</h3></div>`;
             
             const tb = document.querySelector('#client-history-table tbody'); tb.innerHTML = '';
             trs.sort((a,b) => b.timestamp - a.timestamp).forEach(t => tb.innerHTML += `<tr><td>${new Date(t.timestamp).toLocaleDateString()}</td><td>${t.perfumeName} (${t.quantityML} –º–ª)</td><td class="text-right">${t.revenue.toFixed(2)} ‚Ç¥</td><td class="text-right ${t.profit >= 0 ? 'text-success' : 'text-danger'}">${t.profit.toFixed(1)}</td></tr>`);
        }


        // --- MODAL RECEIPT ---
        function generateReceiptHTML(orderItems, totalRounded, clientName) {
            let html = `
                <div class="modal-header">
                    <h3 style="margin:0">–ß–µ–∫</h3>
                    <button class="btn-sm no-print" style="width:auto; background: none; color: var(--dark);" onclick="closeReceiptModal()">‚úï</button>
                </div>
                <div class="modal-body">
                    <p><strong>–î–∞—Ç–∞:</strong> ${new Date().toLocaleString('uk-UA')}</p>
                    <p><strong>–ö–ª—ñ—î–Ω—Ç:</strong> ${clientName || '–ì—ñ—Å—Ç—å'}</p>
                    <table style="width:100%; border-top:1px solid #eee; margin-top:10px;">
            `;
            orderItems.forEach(i => {
                html += `<tr><td style="padding:5px 0">${i.perfumeName} (${i.quantityML} –º–ª)</td><td class="text-right">${i.revenue.toFixed(2)} ‚Ç¥</td></tr>`;
            });
            html += `
                    </table>
                    <div class="receipt-total">–î–æ —Å–ø–ª–∞—Ç–∏: ${totalRounded.toFixed(2)} ‚Ç¥</div>
                </div>
                <div class="no-print admin-buttons-group" style="margin-top: 20px; text-align: center; display: flex; gap: 10px; padding: 0 20px 20px 20px;">
                    <button onclick="window.print()" style="background-color: var(--secondary); flex-grow: 1;"><i class="fa-solid fa-print"></i> –î—Ä—É–∫</button>
                    <button onclick="closeReceiptModal()" style="background-color: #6c757d; flex-grow: 1;">–ó–∞–∫—Ä–∏—Ç–∏</button>
                </div>
            `;
            return html;
        }
        
        function showModalReceipt(orderItems, totalRounded, clientName) {
            const modal = document.getElementById('receiptModal');
            const content = document.getElementById('receiptContent');
            content.innerHTML = generateReceiptHTML(orderItems, totalRounded, clientName);
            modal.style.display = 'block'; // –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞ style.display = 'block'
        }
        
        function closeReceiptModal() {
            document.getElementById('receiptModal').style.display = 'none'; // –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞ style.display = 'none'
        }


        // –ó–∞–ø—É—Å–∫ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        document.addEventListener('DOMContentLoaded', () => {
            loadPerfumePrices(); 
            loadFlaconData(); 
            loadMarkupPresets(); 
            loadSalesSources(); 
            
            populateFormOptions();
            renderExpenseList(); 
            
            showSection('dashboard', document.querySelector('.nav-btn.active')); // –ó–º—ñ–Ω–µ–Ω–æ –Ω–∞ 'dashboard'
            renderOrderList(); 
            updateDashboard();
        });
    </script>
</body>
</html>

